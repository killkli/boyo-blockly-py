{"version":3,"sources":["shell/defs/styles/TerminalMessage.js","shell/TerminalMessage.jsx","shell/handlers/scrollHistory.js","shell/utils/cleanArray.js","shell/defs/styles/Terminal.js","shell/defs/types/Terminal.js","frontendlib/utilities.js","frontendlib/mu-immutable.js","frontendlib/TextContainer.js","frontendlib/dispatcher.js","frontendlib/redact.js","frontendlib/sentry.js","Worker.js","TaskClient.js","RunCode.js","book/pages.json.load_by_url","languages.js","book/store.js","OutputPrediction.js","shell/Terminal.jsx","shell/handlers/validateCommands.js","Hints.js","frontendlib/HookInput.js","Feedback.js","img/birdseye_icon.png","img/language.png","TableOfContents.js","components/HeaderLoginInfo.jsx","App.js","store.js","serviceWorkerRegistration.js","index.js"],"names":["margin","lineHeight","whiteSpace","ansi_up","AnsiUp","TerminalMessage","Component","render","content","this","props","type","Tracebacks","className","style","sourceStyles","color","text","FriendlyMessage","friendly","includes","dangerouslySetInnerHTML","__html","ansi_to_html","data","codeSource","simple","length","frames","terms","map","traceback","tracebackIndex","frame","frameIndex","Frame","RepeatedFrames","exception","message","didyoumean","suggestion","suggestionIndex","tail","name","lines","line","lineno","variables","variable","variableIndex","value","repeatedFramesDescription","_","template","item","itemIndex","ref","useRef","truncated","setTruncated","useState","useLayoutEffect","current","clientHeight","onClick","scrollHistory","direction","commandHistory","historyPosition","previousHistoryPosition","terminalInput","noAutomaticStdout","history","dirtyArray","Array","from","filter","i","undefined","reverse","position","previousPosition","termNode","minWidth","minHeight","maxWidth","maxHeight","borderRadius","overflow","cursor","background","backgroundSize","padding","height","fontSize","fontFamily","display","width","border","marginBottom","outline","PropTypes","object","string","bool","oneOfType","array","func","assert","condition","Error","isArray","thing","iupdate","root","path","updateFn","split","head","newRoot","iset","ipush","list","concat","iremove","index","slice","TextContainer","stateFn","connect","state","dispatcher","memoize","get","actionMaker","wrapper","action","raw","store","dispatch","redact","initialState","dispatched","reducerCases","addReducerCase","reducer","maybeDispatcher","x","makeAction","makeThunk","thunkFn","dispatchWithType","dispatchedAction","args","stateSet","setState","mergeState","merge","statePush","reducerCase","delegateReducer","baseReducer","localState","Proxy","prop","getState","wrapAsync","async","arguments","e","Sentry","Worker_fn","Worker","channel","makeChannel","serviceWorker","scope","taskClient","PyodideClient","terminalRef","React","createRef","pendingOutput","birdseyeLocalStore","localforage","createInstance","storeName","inputCallback","bookSetState","focusTerminal","interrupt","finishedLastRun","Promise","resolve","finishedLastRunResolve","runCode","entry","_runCode","details","title","code","source","shell","writeMessage","console","warn","bookState","running","r","clearStdout","loadedPromise","route","user","questionWizard","editorContent","assistant","numHints","requestingSolution","input","page_slug","pageSlug","step_name","currentStepName","question_wizard","expected_output","expectedOutput","hasPrediction","currentStep","prediction","choices","outputCallback","call","workerProxy","Comlink","interrupted","error","passed","message_sections","runCodeTask","output_parts","part","push","showOutputParts","event","code_source","entry_passed","has_error","Boolean","page_route","num_hints","requesting_solution","section","messages","logEvent","sentry_event","birdseye_objects","call_id","all","flatMapDeep","entries","rootKey","blob","key","fullKey","setItem","then","url","window","open","ranCode","showCodeResult","postCodeEntry","result","messageSections","m","truncate","output","terminal","pushToStdout","animateScroll","scrollToBottom","duration","container","terminalRoot","setTimeout","document","addEventListener","ctrlKey","metaKey","birdseyeUrl","moveStep","languages","visible","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","language","languageConfig","find","l","otherVisibleLanguages","process","REACT_APP_FIREBASE_STAGING","firebaseAnalytics","previousRoute","pages","loading_placeholder","slug","steps","hints","solution","requirements","pageSlugsList","uid","email","developerMode","pagesProgress","processing","specialMessages","pastSpecialMessages","assessmentOpen","lastSeenMessageSections","answer","wrongAnswers","userChoice","codeResult","requestExpectedOutput","isLoaded","currentPage","pageProgress","setPage","afterSetPage","scroller","scrollTo","delay","offset","updateDatabase","location","hash","specialHash","navigate","substring","movePage","delta","pageIndex","stepIndex","step","animateStep","setUserStateAndDatabase","stepDiv","getElementById","animation","loadPages","loadUserAndPages","debouncedSaveEditorContent","debounce","maxWait","setEditorContent","pRetry","axios","pagesUrl","retries","response","loadUser","initialUser","localStore","databaseRequest","getItem","method","updates","join","loadedPromiseResolve","previousUser","URLSearchParams","search","forEach","progress","findStepIndex","migrateUserState","oldSlug","newSlug","step_names","showHint","openAssessment","scrollToNextStep","smooth","scrollInterval","setInterval","clearInterval","question_wizard_status","addSpecialMessage","indexOf","addSpecialMessageToState","closeSpecialMessage","revealSolutionToken","solution_path","indices_path","indices","reorderSolutionLines","startIndex","endIndex","removed","splice","log","codeEntry","timestamp","Date","toISOString","RadioButton","onChange","label","status","isError","icon","selected","faDotCircle","wrong","faTimes","correct","faCheck","faCircle","RadioGroup","correctAnswer","submitted","OutputPrediction","componentDidMount","element","getElementsByClassName","scrollHeight","confettiActive","userFailed","opacity","CorrectConfetti","active","disabled","bookStatePush","timeToFade","config","angle","spread","startVelocity","elementCount","dragFriction","stagger","colors","Terminal","constructor","super","commands","stdout","bind","validateCommands","showWelcomeMessage","showHelp","getStdout","processCommand","handleInput","isTextSelected","getSelection","focus","rootNode","timeout","scrollTop","validCommands","helpFn","clearFn","noDefaults","defaultCommands","help","description","fn","clear","explicitExec","immutables","Object","keys","c","msg","welcomeMessage","cmdObj","usage","rawInput","clearInput","commandResult","command","noHistory","onCommand","noAutoScroll","commandCallback","toUpdate","selectionStart","selectionEnd","componentDidUpdate","prevProps","isEqual","autoFocus","styles","defaults","contentStyle","inputArea","inputAreaStyle","promptLabel","promptLabelStyle","inputStyle","contentClassName","inputAreaClassName","inputClassName","onKeyDown","autoComplete","autoCapitalize","spellCheck","HintsAssistant","hasHints","onCopy","alert","preventDefault","Hints","hintsProgress","hint","RequestSolution1","totalHints","ConfirmSolution1","Parsons","RequestSolution2","ConfirmSolution2","Solution","onDragEnd","destination","droppableId","provided","droppableProps","innerRef","draggableId","id","draggableProps","dragHandleProps","placeholder","tokens","token","tokenIndex","mask","maskedIndices","HookInput","hook","options","createElement","target","useInput","initialValue","FeedbackModal","initialTitle","instructions","close","lastEvent","setFingerprint","uuidv4","comments","trim","post","event_id","headers","Authorization","REACT_APP_SENTRY_DSN","href","ErrorModal","onClose","feedbackContentStyle","TableOfContents","role","chapters","chapter","page","isCurrent","fontWeight","HeaderLoginInfo","EditorButtons","showBirdseye","showEditor","showPythonTutor","showSnoop","showQuestionButton","faStop","faPlay","faBug","encodeURIComponent","faUserGraduate","src","alt","top","faQuestionCircle","Editor","readOnly","mode","theme","onLoad","editor","renderer","setScrollMargin","setPadding","setOptions","showPrintMargin","Shell","cmd","Messages","nonEmptySections","SectionMessages","Assistant","newMessages","some","lastSeenSection","s","classParentString","contentInnerClassName","trigger","requirement","Requirement","onOpening","onClosing","faListCheck","faLightbulb","inputs","QuestionWizard","Markdown","html","copyFunc","navigator","clipboard","writeText","button","closest","currentTarget","contains","classList","codeText","textContent","CourseText","StepButtons","AppComponent","isQuestionWizard","fullIde","WritingPrograms","snoopPageIndex","UnderstandingProgramsWithSnoop","UnderstandingProgramsWithPythonTutor","IntroducingBirdseye","cantUseEditor","MenuPopup","faListOl","checkCopy","faCompress","faExpand","SpecialMessageModal","StepButton","replace","toLowerCase","skip_step","bottom","nested","faBars","size","faCog","modal","SettingsModal","lang","borderColor","languageIcon","left","defaultChecked","setDeveloperMode","checked","selection","codeElement","node","parentElement","querySelectorAll","containsNode","anchorNode","focusNode","App","book","sentryReduxEnhancer","actionTransformer","stateTransformer","omit","sentryDsn","dsn","normalizeDepth","beforeBreadcrumb","breadcrumb","combineReducers","bookReducer","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","createStore","applyMiddleware","thunk","logger","next","reduxStore","pathname","isLocalhost","hostname","match","registerValidSW","swUrl","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","REACT_APP_PRECACHE","catch","ReactDOM","URL","origin","fetch","contentType","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.3f9eadfb.chunk.js","sourcesContent":["export default {\n  margin: '0',\n  lineHeight: '21px',\n  whiteSpace: 'pre',\n}\n","import React, {Component, useState, useRef, useLayoutEffect} from 'react'\nimport AnsiUp from \"ansi_up\";\n\nimport sourceStyles from './defs/styles/TerminalMessage'\nimport * as terms from \"../terms.json\"\nimport _ from \"lodash\";\n\nconst ansi_up = new AnsiUp();\n\nexport default class TerminalMessage extends Component {\n\n  render() {\n    let {content} = this.props;\n\n    if (content.type === \"traceback\") {\n      return <Tracebacks {...content}/>\n    }\n\n    if (content.type === \"syntax_error\") {\n      return <div\n        className=\"traceback\"\n        style={{...sourceStyles, color: \"red\"}}\n      >\n        {content.text}\n        <FriendlyMessage friendly={content.friendly}/>\n      </div>\n    }\n\n    let color = \"white\";\n    if (typeof content === \"object\") {\n      if ([\"stderr\", \"traceback\", \"syntax_error\"].includes(content.type)) {\n        color = \"red\";\n      }\n      content = content.text;\n    }\n\n    return <span\n      style={{...sourceStyles, color}}\n      dangerouslySetInnerHTML={{__html: ansi_up.ansi_to_html(content)}}\n    />\n  }\n}\n\n\nconst Tracebacks = ({data, codeSource}) => {\n  const simple = (\n    codeSource === \"shell\"\n    && data.length === 1\n    && data[0].frames.length === 1\n  );\n  return <div className=\"tracebacks-container\">\n    {!simple &&\n      <div className=\"traceback-exception\">\n        <strong>{terms.error_traceback}</strong>\n      </div>\n    }\n    {\n      data.map((traceback, tracebackIndex) =>\n        <div className=\"traceback\" key={tracebackIndex}>\n          {\n            !simple && traceback.frames.map((frame, frameIndex) =>\n              frame.type === \"frame\" ?\n                <Frame frame={frame} key={frameIndex}/>\n                :\n                <RepeatedFrames frames={frame.frames} key={frameIndex}/>\n            )\n          }\n          <div>\n            <span className=\"traceback-exception\">\n              <strong>{traceback.exception.type}: </strong>{traceback.exception.message}\n            </span>\n            {\" \"}\n            <FriendlyMessage friendly={traceback.friendly}/>\n          </div>\n          {\n            traceback.didyoumean.length > 0 &&\n            <div className=\"traceback-didyoumean\">\n              <i>{terms.did_you_mean}</i>\n              <ul>\n                {\n                  traceback.didyoumean.map((suggestion, suggestionIndex) =>\n                    <li key={suggestionIndex}>{suggestion}?</li>\n                  )\n                }\n              </ul>\n            </div>\n          }\n          {\n            traceback.tail && <div className=\"traceback-tail\">{traceback.tail}</div>\n          }\n        </div>\n      )\n    }\n  </div>;\n}\n\nconst Frame = ({frame}) =>\n  <div className=\"traceback-frame\">\n    {frame.name !== \"<module>\" && <div className=\"traceback-frame-name\">{frame.name}:</div>}\n    <table className=\"traceback-lines-table\">\n      <tbody>\n      {\n        frame.lines.map(line =>\n          <tr key={line.lineno}>\n            <td className=\"traceback-lineno\">{line.lineno}</td>\n            <td className=\"traceback-line-content codehilite\"\n                dangerouslySetInnerHTML={{__html: line.text}}/>\n          </tr>\n        )\n      }\n      </tbody>\n    </table>\n    <table className=\"traceback-variables-table\">\n      <tbody>\n      {\n        frame.variables.map((variable, variableIndex) =>\n          <tr key={variableIndex}>\n            <td className=\"traceback-variable-name codehilite\"\n                dangerouslySetInnerHTML={{__html: variable.name}}/>\n            <td className=\"traceback-variable-value codehilite\"\n                dangerouslySetInnerHTML={{__html: variable.value}}/>\n          </tr>\n        )\n      }\n      </tbody>\n    </table>\n  </div>\n\nconst repeatedFramesDescription = _.template(terms.repeated_frames_description);\n\nconst RepeatedFrames = ({frames}) =>\n  <div className=\"traceback-repeated-frames\">\n    <div>{terms.similar_frames_skipped}</div>\n    <ul>\n      {\n        frames.map((item, itemIndex) =>\n        <li key={itemIndex}>\n          {repeatedFramesDescription(item)}\n        </li>)\n      }\n    </ul>\n  </div>\n\nconst FriendlyMessage = ({friendly}) => {\n  const ref = useRef(null)\n\n  // If the full message is too big, truncate it initially.\n  // Clicking on it resets it to normal.\n  const [truncated, setTruncated] = useState(null);\n  useLayoutEffect(() => {\n    if (truncated == null && ref.current?.clientHeight > 200) {\n      setTruncated(true)\n    }\n  })\n\n  return <>\n    {friendly &&\n      <div className={\"markdown-body\" + (truncated ? \" truncated\" : \"\")}\n           ref={ref}\n           onClick={() => setTruncated(false)}\n           >\n        <div dangerouslySetInnerHTML={{__html: friendly}}/>\n        {truncated &&\n          <div className=\"click-to-expand\">\n            {terms.click_to_expand}\n          </div>\n        }\n      </div>\n    }\n  </>;\n}\n","import cleanArray from '../utils/cleanArray'\n\nexport default function scrollHistory (direction, commandHistory, historyPosition, previousHistoryPosition, terminalInput, noAutomaticStdout) {\n  const history = cleanArray(commandHistory).reverse() // Clean empty items and reverse order to ease position tracking\n  const position = historyPosition\n  const previousPosition = previousHistoryPosition\n  const termNode = terminalInput.current\n\n  if (!noAutomaticStdout && history.length > 0) { // Only run if history is non-empty and in use\n    switch (direction) {\n      case 'up':\n        if (position === null) {\n          // If at no position, get most recent entry\n          termNode.value = history[0]\n          return { historyPosition: 0, previousHistoryPosition: null }\n        } else if (position + 1 === history.length) {\n          // If the first entry will be reached on this press, get it and decrement position by 1 to avoid confusing downscroll\n          termNode.value = history[history.length - 1]\n          return { historyPosition: history.length - 1, previousHistoryPosition: history.length - 2 }\n        } else {\n          // Normal increment by one\n          termNode.value = history[position + 1]\n          return { historyPosition: position + 1, previousHistoryPosition: position }\n        }\n      case 'down':\n        if (position === null || !history[position]) {\n          // If at initial or out of range, clear (Unix-like behaviour)\n          termNode.value = ''\n          return { historyPosition: null, previousHistoryPosition: null }\n        } else if (position - 1 === -1) {\n          // Clear because user pressed up once and is now pressing down again => clear or is reaching bottom\n          if (previousPosition === null || (position === 0 && previousPosition === 1)) termNode.value = ''\n          else termNode.value = history[0]\n\n          return { historyPosition: null, previousHistoryPosition: null }\n        } else {\n          // Normal decrement by one\n          termNode.value = history[position - 1]\n          return { historyPosition: position - 1, previousHistoryPosition: position }\n        }\n    }\n  }\n}\n","/**\n * Workaround to clean an array from 'ghost items'.\n * @param {Array} dirtyArray\n */\nexport default function cleanArray (dirtyArray) {\n  const newArray = Array.from(dirtyArray)\n  return newArray.filter(i => i !== undefined)\n}\n","\nexport default {\n  container: {\n    minWidth: '500px',\n    minHeight: '300px',\n    maxWidth: '100%', // Fill parent before overflowing\n    maxHeight: '100%', // Fill parent before overflowing\n    borderRadius: '5px',\n    overflow: 'auto',\n    cursor: 'text',\n    background: 'rgb(39, 40, 34)',\n    backgroundSize: 'cover'\n  },\n  content: {\n    padding: '20px',\n    height: '100%',\n    fontSize: '15px',\n    color: '#FFFFFF',\n    fontFamily: 'monospace'\n  },\n  inputArea: {\n    display: 'inline-block',\n    width: 'calc(100% - 2.5em)'\n  },\n  promptLabel: {\n    // paddingTop: '3px',\n    // color: '#EE9C34'\n  },\n  input: {\n    border: '0',\n    padding: '0',\n    margin: '0',\n    marginBottom: '2em',\n    width: '100%',\n    background: 'transparent',\n    fontSize: '15px',\n    color: '#FFFFFF',\n    fontFamily: 'monospace',\n    outline: 'none' // Fix for outline showing up on some browsers\n  }\n}\n","import PropTypes from 'prop-types'\n\nconst styleTypes = {\n  style: PropTypes.object,\n  contentStyle: PropTypes.object,\n  inputAreaStyle: PropTypes.object,\n  promptLabelStyle: PropTypes.object,\n  inputStyle: PropTypes.object\n}\n\nconst classNameTypes = {\n  className: PropTypes.string,\n  contentClassName: PropTypes.string,\n  inputAreaClassName: PropTypes.string,\n  promptLabelClassName: PropTypes.string,\n  inputClassName: PropTypes.string\n}\n\nconst optionTypes = {\n  autoFocus: PropTypes.bool,\n  dangerMode: PropTypes.bool,\n  disableOnProcess: PropTypes.bool,\n  noDefaults: PropTypes.bool,\n  noAutomaticStdout: PropTypes.bool,\n  noHistory: PropTypes.bool,\n  noAutoScroll: PropTypes.bool\n}\n\nconst labelTypes = {\n  welcomeMessage: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.array,\n    PropTypes.string\n  ]),\n  promptLabel: PropTypes.string,\n  errorText: PropTypes.string\n}\n\nconst commandTypes = {\n  onCommand: PropTypes.object.func,\n  commandCallback: PropTypes.func\n}\n\nexport default {\n  ...styleTypes,\n  ...classNameTypes,\n  ...optionTypes,\n  ...labelTypes,\n  ...commandTypes\n}\n","/* Helper to determine type */\nexport const isNumber = value => typeof value === \"number\";\nexport const isString = value => typeof value === \"string\";\nexport const isFunction = value => typeof value === \"function\";\n\n/* Basic assert statement */\nexport const assert = (condition, message) => {\n  if (!condition) {\n    throw new Error(message || \"Assertion failed\");\n  }\n};\n\n/* Checks an array has only one element and returns it */\nexport const only = arr => {\n  assert(arr.length === 1, `Expected 1 element, found ${arr.length}`);\n  return arr[0];\n};\n\n/* converts a slug into text */\nexport const unslug = text => text.replace(/_/g, \" \");\n","/* These very simple helper should hopefully make using redux easier without having \n * to add dependencies any complex libraries like Immutable.js\n * \n * It exports two functions to make updating nested structures much easier, pretty \n * much all other tasks can be achieved with normal JS syntax. The main problem is \n * that object literals are just shit, and we want to keep very light syntax.\n * \n * This needs testing but it is very simple code.\n * */\n\n/* Check if something is an Array */\nexport const isObject = thing => thing !== null && typeof thing === \"object\";\n\n/* Check if something is an Object */\nexport const isArray = thing => Array.isArray(thing);\n\n/* Given a nested data structure this will follow the path, and replace\n * the item at the end of the path with the result of calling the updateFn on it.\n * */\nexport const iupdate = (root, path, updateFn) => {\n  if (!isArray(path)) {\n    path = path.split('.');\n  }\n\n  if (path.length === 0) return updateFn(root);\n\n  const [head, ...tail] = path;\n\n  let newRoot;\n  if (isArray(root)) {\n    newRoot = [...root];\n  } else if (isObject(root)) {\n    newRoot = { ...root };\n  } else {\n    throw new Error(`${root} is not an Array or Object, check your path`);\n  }\n\n  if (tail.length === 0) {\n    newRoot[head] = updateFn(root[head]);\n  } else {\n    newRoot[head] = iupdate(root[head], tail, updateFn);\n  }\n\n  return newRoot;\n};\n\n/* Given a nested data structure this will follow the path, and replace\n *  the item at the end of the path with the value.\n */\nexport const iset = (root, path, value) => iupdate(root, path, () => value);\n\n/* Given a nested data structure this will follow the path, and add the \n * given value to the end of the array at that path.\n */\nexport const ipush = (root, path, value) =>\n  iupdate(root, path, list => list.concat([value]));\n\n/* Given a nested data structure this will follow the path, and remove the \n * given idex in the array at that path\n */\nexport const iremove = (root, path, index) =>\n  iupdate(root, path, list => [\n    ...list.slice(0, index),\n    ...list.slice(index + 1)\n  ]);\n","import React from \"react\";\nimport _ from \"lodash\";\nimport {assert} from \"./utilities\";\n\n// To set up, import connect from react-redux and set\n// TextContainer.connect = connect\n\nexport const TextContainer = stateFn => {\n  const TextComponent = ({text}) => (\n    <span>{text}</span>\n  );\n  return TextContainer.connect(\n    state => ({text: stateFn(state)}),\n  )(TextComponent);\n};\n\nexport const PathTextContainer = _.memoize(path => {\n  assert(typeof path === 'string', \"path must be a string\");\n  return TextContainer(state => _.get(state, path));\n});\n\nexport const QuickText = path => {\n  const QuickTextContainer = PathTextContainer(path);\n  return <QuickTextContainer/>\n};\n","export const dispatcher = (actionMaker) => {\n  const wrapper = (...args) => {\n    const action = wrapper.raw(...args);\n    const store = wrapper.store || dispatcher.store;\n    store.dispatch(action);\n  };\n  wrapper.raw = actionMaker;\n  return wrapper;\n};\n\nexport default dispatcher;\n","import { ipush, iset } from \"./mu-immutable\";\nimport { merge } from \"lodash\";\nimport { dispatcher } from \"./dispatcher\";\nimport { assert } from \"./utilities\";\n\n\nexport const redact = (name, initialState = {}, { dispatched } = {}) => {\n  const reducerCases = {};\n\n  const addReducerCase = (type, reducer) => {\n    reducer = reducer || (state => state);\n    assert(!reducerCases[type], 'Type already exists');\n    return reducerCases[type] = reducer;\n  };\n\n  const maybeDispatcher = dispatched ? dispatcher : x => x;\n\n  const makeAction = (type, reducer, actionMaker = value => ({ value })) => {\n    addReducerCase(type, reducer);\n    return maybeDispatcher((...args) => {\n      const action = actionMaker(...args);\n      return {\n        ...action,\n        type,\n      };\n    });\n  };\n\n  const makeThunk = (type, reducer, actionMaker = value => ({ value })) => {\n    addReducerCase(type, reducer);\n    return maybeDispatcher((...args) => {\n      const thunkFn = actionMaker(...args);\n      // Return a function with a similar signature\n      // except it replaces dispatch with a modified version\n      // that automatically adds the type to its argument\n      return (dispatch, ...args) => {\n        const dispatchWithType = (dispatchedAction) => {\n          if (typeof dispatchedAction === 'object') {\n            return dispatch({ type, ...dispatchedAction });\n          }\n          return dispatch(dispatchedAction);\n        };\n        return thunkFn(dispatchWithType, ...args);\n      };\n    });\n  };\n\n\n  const stateSet = makeAction(\n    name + \"_SET_STATE\",\n    (state, { path, value }) => iset(state, path, value),\n    (path, value) => ({ path, value })\n  );\n  const setState = stateSet;\n\n  const mergeState = makeAction(\n    name + '_MERGE_STATE',\n    (state, { value }) => merge({}, state, value)\n  );\n\n  const statePush = makeAction(\n    name + '_PUSH',\n    (state, { path, value }) => ipush(state, path, value),\n    (path, value) => ({ path, value }),\n  );\n\n  const reducer = (state = initialState, action) => {\n    const reducerCase = reducerCases[action.type];\n    if (!reducerCase) {\n      return state;\n    }\n    return reducerCase(state, action);\n  };\n\n  const delegateReducer = (baseReducer) => (state, action) => baseReducer(reducer(state, action), action);\n\n  const localState = new Proxy({}, {\n    get: (_, prop) => redact.store?.getState()[name][prop]\n  });\n\n  return {\n    reducerCases,\n    makeAction,\n    makeThunk,\n    stateSet,\n    setState,\n    mergeState,\n    statePush,\n    reducer,\n    delegateReducer,\n    localState,\n  };\n};\n\nexport default redact;\n","import * as Sentry from \"@sentry/react\";\n\nexport function wrapAsync(func, name) {\n  return async function() {\n    try {\n      return await func(...arguments);\n    } catch (e) {\n      Sentry.setExtra(`${name || func.name || 'anon'}_arguments`, [...arguments]);\n      throw e;\n    }\n  }\n}\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/Worker.9135dd84.worker.js\");\n}\n","// eslint-disable-next-line import/no-webpack-loader-syntax\nimport Worker from \"worker-loader!./Worker.js\";\nimport {makeChannel} from \"sync-message\";\nimport * as Comlink from 'comlink';\nimport {PyodideClient} from \"pyodide-worker-runner\";\n\nconst channel = makeChannel({serviceWorker: {scope: \"/course/\"}});\n\nexport const taskClient = new PyodideClient(() => new Worker(), channel);\n\nexport async function runCodeTask(entry, outputCallback, inputCallback) {\n  let running = true;\n\n  function wrappedOutputCallback(...args) {\n    if (running) {\n      outputCallback(...args);\n    }\n  }\n\n  try {\n    return await taskClient.call(\n      taskClient.workerProxy.runCode,\n      entry,\n      Comlink.proxy(wrappedOutputCallback),\n      Comlink.proxy(inputCallback),\n    );\n  } catch (e) {\n    if (e.type === \"InterruptError\") {\n      return {\n        interrupted: true,\n        error: null,\n        passed: false,\n        message_sections: [],\n      }\n    }\n    throw e;\n  } finally {\n    running = false;\n  }\n}\n","import {\n  bookSetState,\n  bookState,\n  currentStep,\n  currentStepName,\n  postCodeEntry,\n  loadedPromise,\n  logEvent,\n  moveStep,\n  ranCode\n} from \"./book/store\";\nimport _ from \"lodash\";\nimport localforage from \"localforage\";\nimport {animateScroll} from \"react-scroll\";\nimport React from \"react\";\nimport * as Sentry from \"@sentry/react\";\nimport {wrapAsync} from \"./frontendlib/sentry\";\nimport {taskClient, runCodeTask} from \"./TaskClient\";\n\nexport const terminalRef = React.createRef();\n\nlet pendingOutput = [];\n\nconst birdseyeLocalStore = localforage.createInstance({name: \"birdseye\", storeName: \"birdseye\"});\n\nfunction inputCallback() {\n  bookSetState(\"processing\", false);\n  terminalRef.current?.focusTerminal();\n}\n\nexport function interrupt() {\n  taskClient.interrupt();\n}\n\nlet finishedLastRun = Promise.resolve();\nlet finishedLastRunResolve = () => {};\n\nexport async function runCode(entry) {\n  try {\n    await _runCode(entry)\n  } catch (e) {\n    bookSetState(\"error\", {\n      details: e.message,\n      title: \"JS Error while running code: \" + e.name,\n    });\n    Sentry.captureException(e);\n  }\n}\n\nexport const _runCode = wrapAsync(async function runCode({code, source}) {\n  const shell = source === \"shell\";\n  if (shell) {\n    if (taskClient.state === \"awaitingMessage\") {\n      bookSetState(\"processing\", true);\n      try {\n        await taskClient.writeMessage(code);\n      } catch (e) {\n        console.warn(e);\n      }\n      return;\n    }\n  } else {\n    if (bookState.running) {\n      interrupt();\n      await finishedLastRun;\n    }\n    finishedLastRun = new Promise(r => finishedLastRunResolve = r);\n\n    terminalRef.current.clearStdout();\n  }\n\n  pendingOutput = [];\n\n  bookSetState(\"processing\", true);\n  bookSetState(\"running\", true);\n\n  await loadedPromise;\n\n  const {route, user, questionWizard, editorContent, assistant: {numHints, requestingSolution}} = bookState;\n  if (!shell && !code) {\n    code = editorContent;\n  }\n\n  const entry = {\n    input: code,\n    source,\n    page_slug: user.pageSlug,\n    step_name: currentStepName(),\n    question_wizard: route === \"question\",\n    expected_output: questionWizard.expectedOutput,\n  };\n\n  const hasPrediction = currentStep().prediction?.choices;\n\n  function outputCallback(output_parts) {\n    for (const part of output_parts) {\n      part.codeSource = source;\n    }\n    if (hasPrediction || !terminalRef.current) {\n      pendingOutput.push(...output_parts);\n    } else {\n      showOutputParts(output_parts);\n    }\n  }\n\n  let data;\n  try {\n    data = await runCodeTask(\n      entry,\n      outputCallback,\n      inputCallback,\n    );\n  } catch (e) {\n    showOutputParts({text: '>>> ', type: 'shell_prompt'});\n    throw e;\n  } finally {\n    bookSetState(\"processing\", false);\n    bookSetState(\"running\", false);\n  }\n\n  const {error} = data;\n\n  const event = {\n    code_source: entry.source,\n    page_slug: entry.page_slug,\n    step_name: entry.step_name,\n    entry_passed: data.passed,\n    has_error: Boolean(error),\n    page_route: route,\n    num_hints: numHints,\n    requesting_solution: requestingSolution,\n  };\n  for (const section of data.message_sections || []) {\n    event[`num_messages_${section.type}`] = section.messages.length;\n  }\n  logEvent('run_code', event);\n\n  if (error) {\n    Sentry.captureEvent(error.sentry_event);\n    delete error.sentry_event;\n    bookSetState(\"error\", {...error});\n    return;\n  }\n\n  if (data.birdseye_objects) {\n    const {store, call_id} = data.birdseye_objects;\n    delete data.birdseye_objects;\n    Promise.all(\n      _.flatMapDeep(\n        _.entries(store),\n        ([rootKey, blob]) =>\n          _.entries(blob)\n            .map(([key, value]) => {\n              const fullKey = rootKey + \"/\" + key;\n              return birdseyeLocalStore.setItem(fullKey, value);\n            })\n      )\n    ).then(() => {\n      const url = \"/course/birdseye/?call_id=\" + call_id;\n      if (bookState.prediction.state === \"hidden\") {\n        window.open(url);\n      } else {\n        bookSetState(\"prediction.codeResult.birdseyeUrl\", url);\n      }\n    });\n  }\n\n  ranCode(data);\n  if (!bookState.prediction.choices || !data.passed) {\n    showCodeResult(data);\n    terminalRef.current?.focusTerminal();\n  }\n\n  finishedLastRunResolve();\n\n  postCodeEntry({\n    entry,\n    result: {\n      passed: data.passed,\n      messageSections: data.message_sections?.map(section => ({\n        type: section.type,\n        messages: section.messages?.map(m => _.truncate(m, {length: 1000})),\n      })),\n      output: _.truncate(data.output, {length: 1000}),\n    },\n  });\n});\n\ndocument.addEventListener('keydown', function (e) {\n  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n    runCode({source: \"editor\"});\n  }\n});\n\nfunction showOutputParts(output_parts) {\n  const terminal = terminalRef.current;\n  if (!terminal) {\n    setTimeout(() => showOutputParts(output_parts), 500);\n    return;\n  }\n  terminal.pushToStdout(output_parts);\n  animateScroll.scrollToBottom({duration: 0, container: terminal.terminalRoot.current});\n}\n\nexport const showCodeResult = ({birdseyeUrl, passed}) => {\n  pendingOutput.push({text: '>>> ', type: 'shell_prompt'});\n  showOutputParts(pendingOutput);\n  pendingOutput = [];\n\n  if (passed) {\n    moveStep(1);\n  }\n\n  if (birdseyeUrl) {\n    window.open(birdseyeUrl);\n  }\n}\n","export default __webpack_public_path__ + \"static/media/pages.json.5e48284b.load_by_url\";","const languages = [\n  {\n    code: 'en',\n    name: 'English',\n    url: 'https://futurecoder.io/',\n    visible: false,\n    firebaseConfig: {\n      apiKey: \"AIzaSyAZmDPaMC92X9YFbS-Mt0p-dKHIg4w48Ow\",\n      authDomain: \"futurecoder-io.firebaseapp.com\",\n      databaseURL: \"https://futurecoder-io-default-rtdb.firebaseio.com\",\n      projectId: \"futurecoder-io\",\n      storageBucket: \"futurecoder-io.appspot.com\",\n      messagingSenderId: \"361930705093\",\n      appId: \"1:361930705093:web:dda41fee927c949daf88ac\",\n      measurementId: \"G-ZKCE9KY52F\",\n    },\n  },\n  {\n    code: 'fr',\n    name: 'Français',\n    url: 'https://fr.futurecoder.io/',\n    visible: false,\n    firebaseConfig: {\n      apiKey: \"AIzaSyBAC0zYqkdW6hJKD_RyTzBtIgndxyraW6o\",\n      authDomain: \"futurecoder-fr.firebaseapp.com\",\n      databaseURL: \"https://futurecoder-fr-default-rtdb.europe-west1.firebasedatabase.app\",\n      projectId: \"futurecoder-fr\",\n      storageBucket: \"futurecoder-fr.appspot.com\",\n      messagingSenderId: \"453289812685\",\n      appId: \"1:453289812685:web:1b390689ec643db8533f84\",\n      measurementId: \"G-E3E2910NY5\"\n    }\n  },\n  {\n    code: 'es',\n    name: 'Español',\n    url: 'https://es-latam.futurecoder.io/',\n    visible: false,\n    firebaseConfig: {\n      apiKey: \"AIzaSyDNpI4qJjFfRWuFqOnonuqmJGYr0Hp3Iuk\",\n      authDomain: \"futurecoder-es-latam.firebaseapp.com\",\n      databaseURL: \"https://futurecoder-es-latam-default-rtdb.firebaseio.com\",\n      projectId: \"futurecoder-es-latam\",\n      storageBucket: \"futurecoder-es-latam.appspot.com\",\n      messagingSenderId: \"1084443780130\",\n      appId: \"1:1084443780130:web:cb507edf79f9ba131b967b\",\n      measurementId: \"G-W0ZYL2E5W5\"\n    }\n  },\n  {\n    code: 'ta',\n    name: 'தமிழ்',\n    url: 'https://ta.futurecoder.io/',\n    visible: false,\n    firebaseConfig: {\n      apiKey: \"AIzaSyCatBdK3vpK_o7fWxafl-4GtjDKW9en9mY\",\n      authDomain: \"futurecoder-ta.firebaseapp.com\",\n      databaseURL: \"https://futurecoder-ta-default-rtdb.asia-southeast1.firebasedatabase.app\",\n      projectId: \"futurecoder-ta\",\n      storageBucket: \"futurecoder-ta.appspot.com\",\n      messagingSenderId: \"551486140162\",\n      appId: \"1:551486140162:web:5cf955d9675eeb3e2e1c1b\",\n      measurementId: \"G-3PK2WP7CCD\"\n    }\n  },\n  {\n    code: 'zh',\n    name: '中文',\n    url: 'https://zh.futurecoder.io/',\n    visible: false,\n    firebaseConfig: {\n      apiKey: \"AIzaSyCatBdK3vpK_o7fWxafl-4GtjDKW9en9mY\",\n      authDomain: \"futurecoder-ta.firebaseapp.com\",\n      databaseURL: \"https://futurecoder-ta-default-rtdb.asia-southeast1.firebasedatabase.app\",\n      projectId: \"futurecoder-ta\",\n      storageBucket: \"futurecoder-ta.appspot.com\",\n      messagingSenderId: \"551486140162\",\n      appId: \"1:551486140162:web:5cf955d9675eeb3e2e1c1b\",\n      measurementId: \"G-3PK2WP7CCD\"\n    }\n  },\n];\n\nexport let language = 'zh';\n// export let language = process.env.REACT_APP_LANGUAGE;\nexport let languageConfig = languages.find((l) => l.code === language);\nif (!languageConfig) {\n  languageConfig = languages[0];\n  language = languageConfig.code;\n}\n\nif (!languageConfig.firebaseConfig) {\n  languageConfig.firebaseConfig = languages[0].firebaseConfig;\n}\n\nexport const otherVisibleLanguages = languages.filter(\n  (l) => l.code !== language && l.visible\n);\n","import {ipush, iremove, iset, redact} from \"../frontendlib\";\nimport {animateScroll, scroller} from \"react-scroll\";\nimport _ from \"lodash\";\nimport {terminalRef} from \"../RunCode\";\nimport firebase from \"firebase/app\";\nimport \"firebase/auth\";\nimport \"firebase/analytics\";\nimport pagesUrl from \"./pages.json.load_by_url\"\nimport axios from \"axios\";\nimport * as terms from \"../terms.json\"\nimport * as Sentry from \"@sentry/react\";\nimport {wrapAsync} from \"../frontendlib/sentry\";\nimport pRetry from 'p-retry';\nimport localforage from \"localforage\";\nimport {languageConfig} from \"../languages\";\n\nexport const disableFirebase = !!process.env.REACT_APP_DISABLE_FIREBASE;\nexport const disableLogin = disableFirebase || !!process.env.REACT_APP_DISABLE_LOGIN;\n\nconst firebaseConfig = !process.env.REACT_APP_FIREBASE_STAGING ? languageConfig.firebaseConfig : {\n  apiKey: \"AIzaSyC3S9l7lI3f3IiiWURO_AGmWBTLP0lKeC0\",\n  authDomain: \"futurecoder-staging.firebaseapp.com\",\n  databaseURL: \"https://futurecoder-staging-default-rtdb.firebaseio.com\",\n  projectId: \"futurecoder-staging\",\n  storageBucket: \"futurecoder-staging.appspot.com\",\n  messagingSenderId: \"513885780206\",\n  appId: \"1:513885780206:web:1144315640a5ba46c01bff\"\n};\nconst firebaseApp = !disableFirebase && firebase.initializeApp(firebaseConfig);\n\nlet {databaseURL} = firebaseConfig;\n\nif (!disableFirebase && process.env.REACT_APP_USE_FIREBASE_EMULATORS && window.location.hostname === \"localhost\") {\n  // firebase.database().useEmulator(\"localhost\", 9009);\n  databaseURL = \"http://localhost:9009\";\n  firebase.auth().useEmulator(\"http://localhost:9099\");\n}\n\nlet firebaseAnalytics;\nexport const isProduction = !disableFirebase && window.location.hostname.endsWith(\"futurecoder.io\");\nif (isProduction) {\n  firebase.analytics.isSupported().then((isSupported) => {\n    if (isSupported) {\n      firebaseAnalytics = firebase.analytics(firebaseApp);\n    }\n  });\n}\n\nconst initialState = {\n  error: null,\n  route: \"main\",\n  previousRoute: \"main\",\n  pages: {\n    loading_placeholder: {\n      title: terms.loading_wait,\n      slug: \"loading_placeholder\",\n      index: 0,\n      steps: [\n        {\n          index: 0,\n          text: \"\",\n          hints: [],\n          name: \"loading_placeholder\",\n          solution: null,\n          requirements: null,\n        }\n      ],\n    },\n  },\n  pageSlugsList: [\"loading_placeholder\"],\n  user: {\n    uid: null,\n    email: \"\",\n    developerMode: false,\n    pagesProgress: {\n      loading_placeholder: {\n        step_name: \"loading_placeholder\",\n      }\n    },\n    pageSlug: \"loading_placeholder\",\n  },\n  processing: false,\n  running: false,\n  editorContent: \"\",\n  specialMessages: [],\n  pastSpecialMessages: [],\n  assessmentOpen: false,\n  assistant: {\n    numHints: 0,\n    messageSections: [],\n    requestingSolution: 0,\n    lastSeenMessageSections: [],\n  },\n  prediction: {\n    choices: null,\n    answer: \"\",\n    wrongAnswers: [],\n    userChoice: \"\",\n    state: \"hidden\",\n    codeResult: {},\n  },\n  questionWizard: {\n    messages: [],\n    requestExpectedOutput: false,\n    expectedOutput: \"\",\n  }\n};\n\n\nconst {reducer, makeAction, setState, localState, statePush} = redact('book', initialState, {dispatched: true});\n\nexport {reducer as bookReducer, setState as bookSetState, localState as bookState, statePush as bookStatePush};\n\nconst isLoaded = (state) => state.user.uid && state.pageSlugsList.length > 1\n\nexport const currentPage = (state = localState) => {\n  if (!isLoaded(state)) {\n    return initialState.pages.loading_placeholder;\n  }\n  return state.pages[state.user.pageSlug];\n};\n\nconst pageProgress = (state = localState) => {\n  if (!isLoaded(state)) {\n    return initialState.user.pagesProgress.loading_placeholder;\n  }\n  return state.user.pagesProgress[state.user.pageSlug];\n};\n\nexport const currentStepName = (state = localState) => pageProgress(state).step_name;\nexport const currentStep = (state = localState) =>\n  _.find(currentPage(state).steps, {name: currentStepName(state)});\n\nexport const setPage = (page_slug) => {\n  setState(\"user.pageSlug\", page_slug);\n  setState(\"assistant\", initialState.assistant);\n  afterSetPage(page_slug);\n};\n\nconst afterSetPage = (pageSlug, state = localState) => {\n    setTimeout(() =>\n      scroller.scrollTo(`step-text-${currentStep(state).index}`, {\n        delay: 0,\n        duration: 0,\n        offset: -60,\n      }),\n    120,\n  )\n  updateDatabase({pageSlug});\n  window.location.hash = pageSlug;\n}\n\nexport const specialHash = (hash) => [\"toc\", \"ide\", \"question\"].includes(hash);\n\nexport const navigate = () => {\n  const hash = window.location.hash.substring(1);\n  setState(\"previousRoute\", localState.route)\n  if (specialHash(hash)) {\n    setState(\"route\", hash);\n  } else if (_.includes(localState.pageSlugsList, hash)) {\n    setState(\"route\", \"main\");\n    setPage(hash);\n  }\n};\nwindow.addEventListener(\"hashchange\", navigate);\n\nexport const setPageIndex = (pageIndex) => {\n  setPage(localState.pageSlugsList[pageIndex]);\n};\n\nexport const movePage = (delta) => {\n  setPageIndex(currentPage().index + delta);\n};\n\nexport const moveStep = (delta) => {\n  const stepIndex = currentStep().index + delta;\n  const step = currentPage().steps[stepIndex];\n  if (!step) {\n    return;\n  }\n\n  if (delta > 0) {\n    animateStep(stepIndex);\n  }\n  setUserStateAndDatabase([\"pagesProgress\", localState.user.pageSlug, \"step_name\"], step.name);\n  setState(\"assistant\", initialState.assistant);\n};\n\nconst animateStep = (stepIndex) => {\n  const stepDiv = document.getElementById(`step-text-${stepIndex}`);\n  if (stepDiv) {\n    stepDiv.style.animation = 'next-step-transition 0.7s ease-out, next-step-flash 3s ease-out 0.7s';\n  }\n}\n\nconst loadPages = makeAction(\n  \"LOAD_PAGES\",\n  (state, {value: {pages, pageSlugsList}}) => {\n    return loadUserAndPages({\n      ...state,\n      pages,\n      pageSlugsList,\n    });\n  },\n)\n\nconst debouncedSaveEditorContent = _.debounce(\n  editorContent => updateDatabase({editorContent}),\n  3000,\n  {maxWait: 15000},\n);\n\nexport function setEditorContent(editorContent) {\n  setState(\"editorContent\", editorContent);\n  // noinspection JSValidateTypes\n  debouncedSaveEditorContent(editorContent);\n}\n\npRetry(() => wrapAsync(axios.get, \"axios_get\")(pagesUrl), {retries: 3})\n  .then((response) => loadPages(response.data));\n\nconst loadUser = makeAction(\n  \"LOAD_USER\",\n  (state, {value: {editorContent, ...user}}) => {\n    state = iset(state, \"editorContent\", state.editorContent || editorContent || \"\");\n    return loadUserAndPages({...state, user}, state.user);\n  },\n);\n\n// Reset state to clear out user data\nexport const signOut = makeAction(\n  \"SIGN_OUT\",\n  (state) => {\n    return loadUserAndPages({\n      ...state,\n      editorContent: \"\",\n      user: {\n        ...initialState.user,\n        // Avoid an empty user.uid so that this cleared state is saved to the local store,\n        // so signing out has an effect even when offline.\n        ...initialUser,\n        // Stay on the current page, rather than the initial loading_placeholder which breaks.\n        pageSlug: state.user.pageSlug,\n      }\n    }, {});\n  },\n);\n\nif (!disableFirebase) {\n  firebase.auth().onAuthStateChanged(async (user) => {\n    if (user) {\n      // TODO ideally we'd set a listener on the user instead of just getting it once\n      //   to sync changes made on multiple devices\n      await updateUserData(user);\n    } else {\n      await firebase.auth().signInAnonymously();\n    }\n  });\n}\n\nexport const updateUserData = async (user) => {\n  Sentry.setUser({id: user.uid});\n  const userData = await databaseRequest(\"GET\");\n  // loadUser should be called on the local store data first\n  // for proper merging with the firebase user data in loadUserAndPages\n  await loadUserFromLocalStorePromise;\n  loadUser({\n    uid: user.uid,\n    email: user.email,\n    ...userData,\n  });\n}\n\nexport const initialUser = {uid: \"__futurecoder_offline__\"}\n\nexport const localStore = localforage.createInstance({name: \"futurecoder\"});\n\nconst loadUserFromLocalStorePromise = localStore.getItem(\"user\").then(user => {\n  loadUser(user || initialUser);\n});\n\nexport const databaseRequest = wrapAsync(async function databaseRequest(method, data={}, endpoint=\"users\") {\n  if (disableFirebase) {\n    return;\n  }\n  const currentUser = firebase.auth().currentUser;\n  if (!currentUser) {\n    return;\n  }\n  const auth = await currentUser.getIdToken();\n  const response = await pRetry(() =>\n      axios.request({\n        url: `${databaseURL}/${endpoint}/${currentUser.uid}.json`,\n        params: {auth},\n        method,\n        data,\n      }),\n    {retries: 3},\n  )\n  return response.data;\n});\n\nexport const updateDatabase = (updates) => {\n  return databaseRequest(\"PATCH\", updates);\n}\n\nconst setUserStateAndDatabase = (path, value) => {\n  if (typeof path === \"string\") {\n    path = [path];\n  }\n  setState([\"user\", ...path], value);\n  updateDatabase({[path.join(\"/\")]: value});\n}\n\nlet loadedPromiseResolve;\nexport const loadedPromise = new Promise((resolve) => {loadedPromiseResolve = resolve});\n\nconst loadUserAndPages = (state, previousUser = {}) => {\n  if (!isLoaded(state)) {\n    return state;\n  }\n  let {\n    user: {pagesProgress, pageSlug, developerMode},\n    pages,\n    pageSlugsList\n  } = state;\n\n  developerMode = developerMode || previousUser.developerMode || false;\n  const updates = {developerMode};\n\n  const hash = window.location.hash.substring(1);\n\n  if (!pageSlug) {\n    if (previousUser.uid && previousUser.pageSlug !== \"loading_placeholder\") {\n      pageSlug = previousUser.pageSlug;\n    } else if (_.includes(pageSlugsList, hash)) {\n      pageSlug = hash;\n    } else {\n      // Check URL parameters for legacy URLs, otherwise default to first page\n      pageSlug = new URLSearchParams(window.location.search).get('page') || pageSlugsList[0];\n    }\n  }\n\n  pagesProgress = {...(pagesProgress || {})};\n  pageSlugsList.forEach(slug => {\n    const steps = pages[slug].steps;\n    let step_name = pagesProgress[slug]?.step_name || steps[0].name;\n    const progress = previousUser.pagesProgress?.[slug];\n    if (progress) {\n      const findStepIndex = (name) => _.find(steps, {name})?.index || 0\n      const previousIndex = findStepIndex(progress.step_name);\n      const currentIndex =  findStepIndex(step_name);\n      if (previousIndex > currentIndex) {\n        step_name = progress.step_name;\n        updates[`pagesProgress/${slug}/step_name`] = step_name;\n      }\n    }\n    pagesProgress[slug] = {step_name};\n  });\n\n  migrateUserState(pages, pagesProgress, updates);\n\n  updateDatabase(updates);\n\n  state = {...state, user: {...state.user, pagesProgress, pageSlug, developerMode}};\n  if (!specialHash(hash)) {\n    afterSetPage(pageSlug, state);\n  }\n\n  loadedPromiseResolve();\n\n  return state;\n}\n\nfunction migrateUserState(pages, pagesProgress, updates) {\n  const oldSlug = \"GettingElementsAtPosition\";\n  const newSlug = \"GettingElementsAtPositionExercises\";\n  const {step_name} = pagesProgress[oldSlug];\n  if (!pages[oldSlug].step_names.includes(step_name)) {\n    pagesProgress[oldSlug] = {step_name: \"final_text\"};\n    pagesProgress[newSlug] = {step_name};\n    updates[`pagesProgress/${oldSlug}/step_name`] = \"final_text\";\n    updates[`pagesProgress/${newSlug}/step_name`] = step_name;\n  }\n}\n\nexport const showHint = makeAction(\n  'SHOW_HINT',\n  (state) => iset(state, \"assistant.numHints\", state.assistant.numHints + 1),\n);\n\nexport const openAssessment = makeAction(\n  'OPEN_ASSESSMENT',\n  (state) => {\n    state = iset(state, \"assessmentOpen\", true);\n    state = iset(state, \"assistant.lastSeenMessageSections\", state.assistant.messageSections);\n    return state;\n  },\n);\n\nexport const scrollToNextStep = () => {\n  setTimeout(() =>\n      scroller.scrollTo(`step-text-${currentStep().index}`, {\n        duration: 1000,\n        smooth: true,\n        offset: -60,\n      }),\n    500,\n  )\n};\n\nexport const ranCode = makeAction(\n  'RAN_CODE',\n  (state, {value}) => {\n    const prediction = currentStep(state).prediction;\n\n    if (value.passed) {\n      scrollToNextStep();\n\n      state = {\n        ...state,\n        assistant: initialState.assistant,\n        prediction: {\n          ...prediction,\n          userChoice: \"\",\n          wrongAnswers: [],\n          state: prediction.choices ? \"waiting\" : \"hidden\",\n          codeResult: value,\n        },\n      };\n\n      if (prediction.choices) {\n        const scrollInterval = setInterval(() => {\n          animateScroll.scrollToBottom({duration: 30, container: terminalRef.current.terminalRoot.current});\n        }, 30);\n        setTimeout(() => clearInterval(scrollInterval), 1300);\n      }\n    }\n\n    if (state.route === \"question\") {\n      if (value.question_wizard_status === \"expected_output\") {\n        state = iset(state, \"questionWizard.requestExpectedOutput\", true);\n        state = iset(state, \"questionWizard.messages\", []);\n      } else if (value.question_wizard_status === \"messages\") {\n        state = iset(state, \"questionWizard.messages\", value.messages);\n      }\n    } else {\n      state = iset(state, \"assistant.messageSections\", value.message_sections);\n      if (state.assessmentOpen) {\n        state = iset(state, \"assistant.lastSeenMessageSections\", value.message_sections);\n      }\n    }\n\n    return state;\n  },\n);\n\n// 'Special messages' currently only means the \"don't copy\" popup.\n// It used to be all kinds of messages, but those coming from the Python checker\n// (now called 'messageSections') have been moved into the assistant.\nconst addSpecialMessageToState = (state, message) => {\n  if (message && state.pastSpecialMessages.indexOf(message) === -1) {\n      animateScroll.scrollToBottom({duration: 1000, delay: 500});\n      state = ipush(state, \"specialMessages\", message);\n      state = ipush(state, \"pastSpecialMessages\", message);\n    }\n  return state;\n}\n\nexport const addSpecialMessage = makeAction(\n  'ADD_SPECIAL_MESSAGE',\n  (state, {value}) => addSpecialMessageToState(state, value)\n)\n\nexport const closeSpecialMessage = makeAction(\n  'CLOSE_SPECIAL_MESSAGE',\n  (state, {value}) => iremove(state, \"specialMessages\", value)\n)\n\nexport const revealSolutionToken = makeAction(\n  \"REVEAL_SOLUTION_TOKEN\",\n  (state) => {\n    const solution_path = [\"pages\", state.user.pageSlug, \"steps\", currentStep(state).index, \"solution\"];\n    const indices_path = [...solution_path, \"maskedIndices\"]\n    const indices = _.get(state, indices_path);\n    if (!indices.length) {\n      return state;\n    }\n    state = iremove(state, indices_path, 0);\n    state = iset(state, [...solution_path, \"mask\", indices[0]], false);\n    return state;\n  }\n)\n\nexport const setDeveloperMode = (value) => {\n  setUserStateAndDatabase(\"developerMode\", value);\n}\n\nexport const reorderSolutionLines = makeAction(\n  \"REORDER_SOLUTION_LINES\",\n  (state, {startIndex, endIndex}) => {\n    const path = [\"pages\", state.user.pageSlug, \"steps\", currentStep(state).index, \"solution\", \"lines\"];\n    const result = Array.from(_.get(state, path));\n    const [removed] = result.splice(startIndex, 1);\n    result.splice(endIndex, 0, removed);\n    return iset(state, path, result);\n  },\n  (startIndex, endIndex) => ({startIndex, endIndex})\n)\n\nexport function logEvent(name, data = {}) {\n  console.log(\"Logging event\", name, data);\n  firebaseAnalytics?.logEvent(name, data);\n}\n\nexport function postCodeEntry(codeEntry) {\n  const {user: {developerMode}, route, assistant: {numHints, requestingSolution}} = localState;\n  codeEntry = {\n    ...codeEntry,\n    state: {\n      developerMode,\n      page_route: route,\n      num_hints: numHints,\n      requesting_solution: requestingSolution,\n    },\n    timestamp: new Date().toISOString(),\n  };\n  console.log(\"Posting code entry\", codeEntry);\n  if (isProduction) {\n    databaseRequest(\"POST\", codeEntry, \"code_entries\").catch(e => console.error(e));\n  }\n}\n","import React, {Component} from \"react\";\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\nimport {faCheck, faCircle, faDotCircle, faTimes} from \"@fortawesome/free-solid-svg-icons\";\nimport {bookSetState, bookStatePush, scrollToNextStep} from \"./book/store\";\nimport {showCodeResult, terminalRef} from \"./RunCode\";\nimport Confetti from \"react-dom-confetti\";\nimport {animateScroll} from \"react-scroll\";\nimport _ from \"lodash\";\nimport * as terms from \"./terms.json\"\n\nconst RadioButton = ({onChange, label, status, isError}) => (\n  <div className={\"prediction-choice prediction-\" + status}\n       onClick={onChange}>\n    <FontAwesomeIcon\n      icon={{\n        selected: faDotCircle,\n        wrong: faTimes,\n        correct: faCheck,\n        \"\": faCircle,\n      }[status]}\n    />\n    <div className=\"prediction-label\" style={{color: isError ? \"red\" : \"white\"}}>\n      {label}\n    </div>\n  </div>\n);\n\nconst RadioGroup = (\n  {\n    choices,\n    onChange,\n    value,\n    correctAnswer,\n    wrongAnswers,\n    submitted\n  }) => (\n  <div>\n    {choices.map((label, i) => {\n      let status = \"\";\n      if (_.includes(wrongAnswers, label)) {\n        status = \"wrong\";\n      } else if (submitted && correctAnswer === label) {\n        status = \"correct\";\n      } else if (value === label) {\n        status = \"selected\";\n      }\n      return (\n        <RadioButton\n          key={i}\n          label={label}\n          onChange={() => onChange(label)}\n          status={status}\n          isError={i === choices.length - 1}\n        />\n      );\n    })}\n  </div>\n);\n\nexport class OutputPrediction extends Component {\n  componentDidMount() {\n    setTimeout(() => {\n      const element = document.getElementsByClassName(\"output-prediction\")[0];\n      bookSetState(\"prediction.height\", element.scrollHeight + \"px\");\n    }, 100);\n  }\n\n  render() {\n    const {\n      choices,\n      codeResult,\n      state,\n      userChoice,\n      answer,\n      wrongAnswers,\n      height\n    } = this.props.prediction;\n    const confettiActive = state === \"showingResult\" && answer === userChoice;\n    let message;\n    if (state === \"waiting\") {\n      if (wrongAnswers.length === 0) {\n        message = terms.output_prediction_question;\n      } else {\n        message = terms.output_prediction_wrong_once;\n      }\n    } else if (userChoice === answer) {\n      message = terms.output_prediction_correct;\n    } else {\n      message = terms.output_prediction_wrong_twice;\n    }\n\n    const userFailed = wrongAnswers.length === 2;\n    return <div\n      className=\"output-prediction\"\n      style={{\n        height: height,\n        opacity: state === \"waiting\" || state === \"showingResult\" ? 1 : 0,\n      }}\n    >\n      <RadioGroup\n        choices={choices}\n        onChange={value =>\n          state === \"waiting\" &&\n          !_.includes(wrongAnswers, value) &&\n          bookSetState(\"prediction.userChoice\", value)\n        }\n        value={userChoice}\n        correctAnswer={answer}\n        wrongAnswers={wrongAnswers}\n        submitted={state === \"showingResult\" || state === \"fading\"}\n      />\n      <div className=\"submit-prediction\">\n        <CorrectConfetti active={confettiActive}/>\n        <div><strong>{message}</strong></div>\n        <button\n          style={{\n            opacity:\n              state === \"waiting\" ||\n              (state === \"showingResult\" && userFailed)\n                ? 1 : 0\n          }}\n          className=\"btn btn-primary\"\n          disabled={!userChoice && !userFailed}\n          onClick={() => {\n            if (userChoice !== answer && !userFailed) {\n              bookStatePush(\"prediction.wrongAnswers\", userChoice);\n              bookSetState(\"prediction.userChoice\", null);\n              if (wrongAnswers.length === 1) {\n                bookSetState(\"prediction.state\", \"showingResult\");\n              }\n              return;\n            }\n            scrollToNextStep();\n            bookSetState(\"prediction.state\", \"showingResult\");\n            setTimeout(() => animateScroll.scrollToBottom({\n              duration: 30,\n              container: terminalRef.current.terminalRoot.current\n            }));\n            const timeToFade = userFailed ? 0 : 3000;\n            setTimeout(() => {\n              bookSetState(\"prediction.state\", \"fading\");\n              bookSetState(\"prediction.height\", 0);\n              showCodeResult(codeResult);\n            }, timeToFade);\n            setTimeout(() => bookSetState(\"prediction.state\", \"hidden\"), timeToFade + 1000);\n          }}\n        >\n          {userFailed ? terms.ok : terms.submit}\n        </button>\n      </div>\n    </div>\n  }\n}\n\nconst CorrectConfetti = ({active}) =>\n  <Confetti\n    active={active}\n    config={{\n      angle: \"360\",\n      spread: 360,\n      startVelocity: \"32\",\n      elementCount: \"117\",\n      dragFriction: \"0.13\",\n      duration: \"2500\",\n      stagger: \"5\",\n      width: \"17px\",\n      height: \"18px\",\n      colors: [\n        \"#a864fd\",\n        \"#29cdff\",\n        \"#78ff44\",\n        \"#ff718d\",\n        \"#fdff6a\",\n      ]\n    }}\n  />\n","import React, {Component} from 'react'\nimport defaults from 'defaults'\nimport isEqual from 'react-fast-compare'\n// Components\nimport TerminalMessage from './TerminalMessage'\n// Handlers\nimport validateCommands from './handlers/validateCommands'\nimport scrollHistory from './handlers/scrollHistory'\n// Definitions\nimport sourceStyles from './defs/styles/Terminal'\nimport types from './defs/types/Terminal'\nimport {bookState} from \"../book/store\";\nimport {OutputPrediction} from \"../OutputPrediction\";\n\nexport default class Terminal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      commands: {},\n      stdout: [],\n      history: [],\n      historyPosition: null,\n      previousHistoryPosition: null,\n      processing: false\n    };\n\n    this.terminalRoot = React.createRef();\n    this.terminalInput = React.createRef();\n\n    this.focusTerminal = this.focusTerminal.bind(this);\n    this.validateCommands = this.validateCommands.bind(this);\n    this.showWelcomeMessage = this.showWelcomeMessage.bind(this);\n    this.showHelp = this.showHelp.bind(this);\n    this.pushToStdout = this.pushToStdout.bind(this);\n    this.getStdout = this.getStdout.bind(this);\n    this.clearStdout = this.clearStdout.bind(this);\n    this.processCommand = this.processCommand.bind(this);\n    this.handleInput = this.handleInput.bind(this)\n  }\n\n  static propTypes = types;\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  focusTerminal() {\n    // Only focus the terminal if text isn't being copied\n    const isTextSelected = window.getSelection().type === 'Range';\n    const input = this.terminalInput.current;\n    if (!isTextSelected && input) input.focus()\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  scrollToBottom() {\n    const rootNode = this.terminalRoot.current;\n\n    // This may look ridiculous, but it is necessary to decouple execution for just a millisecond in order to scroll all the way\n    [1, 10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900].forEach(timeout =>\n      setTimeout(() => {\n        rootNode.scrollTop = rootNode.scrollHeight\n      }, timeout)\n    )\n  }\n\n  validateCommands() {\n    const validCommands = validateCommands(\n      this.props.commands,\n      this.showHelp,\n      this.clearStdout,\n      this.props.noDefaults\n    );\n\n    this.setState({commands: validCommands})\n  }\n\n  showWelcomeMessage() {\n    const msg = this.props.welcomeMessage;\n\n    if (typeof msg === 'boolean') this.pushToStdout('Welcome to the React terminal! Type \\'help\\' to get a list of commands.');\n    else if (Array.isArray(msg)) msg.map(item => this.pushToStdout(item));\n    else this.pushToStdout(msg)\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  showHelp() {\n    const {commands} = this.state;\n\n    for (const c in commands) {\n      const cmdObj = commands[c];\n      const usage = cmdObj.usage ? ` - ${cmdObj.usage}` : '';\n\n      this.pushToStdout(`${c} - ${cmdObj.description}${usage}`)\n    }\n  }\n\n  pushToStdout(message, rawInput) {\n    const {stdout, history} = this.state;\n\n    if (message instanceof Array) {\n      stdout.push(...message);\n    } else {\n      stdout.push(message);\n    }\n\n    /* istanbul ignore if: Covered by interactivity tests */\n    if (rawInput) { // Only supplied if history is enabled\n      history.push(rawInput);\n      this.setState({stdout: stdout, history: history, historyPosition: null})\n    } else {\n      this.setState({stdout: stdout})\n    }\n  }\n\n  getStdout() {\n    return this.state.stdout.map((line, i) => <TerminalMessage key={i} content={line}/>)\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  clearStdout() {\n    this.setState({stdout: []})\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  clearInput() {\n    this.setState({historyPosition: null});\n    this.terminalInput.current.value = ''\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  processCommand() {\n    this.setState({processing: true}, () => {\n      // Initialise command result object\n      const commandResult = {command: null, args: [], rawInput: null, result: null};\n      const rawInput = this.terminalInput.current.value;\n\n      if (!this.props.noAutomaticStdout) {\n\n        const message = rawInput + '\\n';\n        if (!this.props.noHistory) this.pushToStdout(message, rawInput);\n        else this.pushToStdout(message)\n      }\n\n      commandResult.rawInput = rawInput;\n      commandResult.result = this.props.onCommand(rawInput, this.pushToStdout);\n\n      this.setState({processing: false}, () => {\n        this.clearInput();\n        if (!this.props.noAutoScroll) this.scrollToBottom();\n        if (this.props.commandCallback) this.props.commandCallback(commandResult)\n      })\n    })\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  scrollHistory(direction) {\n    const toUpdate = scrollHistory(\n      direction,\n      this.state.history,\n      this.state.historyPosition,\n      this.state.previousHistoryPosition,\n      this.terminalInput,\n      this.props.noAutomaticStdout\n    );\n\n    this.setState(toUpdate);\n    const input = this.terminalInput.current;\n    setTimeout(() => {\n      // Move cursor to end\n      input.selectionStart = input.selectionEnd = 10000;\n    }, 30);\n  }\n\n  /* istanbul ignore next: Covered by interactivity tests */\n  handleInput(event) {\n    switch (event.key) {\n      case 'Enter':\n        if (!(event.ctrlKey || event.metaKey)) {\n          this.processCommand();\n        }\n        break;\n      case 'ArrowUp':\n        this.scrollHistory('up');\n        break;\n      case 'ArrowDown':\n        this.scrollHistory('down');\n        break\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    // If there was a change in commands, re-validate\n    if (!isEqual(prevProps.commands, this.props.commands)) this.validateCommands()\n  }\n\n  componentDidMount() {\n    this.validateCommands();\n    if (this.props.welcomeMessage) this.showWelcomeMessage();\n    /* istanbul ignore next: Covered by interactivity tests */\n    if (this.props.autoFocus) this.focusTerminal()\n    this.pushToStdout(\">>> \");\n  }\n\n  render() {\n    const styles = {\n      container: defaults(this.props.style, sourceStyles.container),\n      content: defaults(this.props.contentStyle, sourceStyles.content),\n      inputArea: defaults(this.props.inputAreaStyle, sourceStyles.inputArea),\n      promptLabel: defaults(this.props.promptLabelStyle, sourceStyles.promptLabel),\n      input: defaults(this.props.inputStyle, sourceStyles.input)\n    };\n\n    return (\n      <div\n        ref={this.terminalRoot}\n        name={'react-console-emulator'}\n        className={this.props.className}\n        style={styles.container}\n        onClick={this.focusTerminal}\n      >\n        {/* Content */}\n        <div\n          name={'react-console-emulator__content'}\n          className={this.props.contentClassName}\n          style={styles.content}\n        >\n          {/* Stdout */}\n          {this.getStdout()}\n          {/* Input area */}\n          <div\n            name={'react-console-emulator__inputArea'}\n            className={this.props.inputAreaClassName}\n            style={styles.inputArea}\n          >\n            {/* Input */}\n            {bookState.processing &&\n            <div className=\"lds-ellipsis\">\n              <div/>\n              <div/>\n              <div/>\n              <div/>\n            </div>}\n\n            {bookState.prediction.state !== \"waiting\" && bookState.prediction.state !== \"showingResult\" &&\n            <input\n              ref={this.terminalInput}\n              name={'react-console-emulator__input'}\n              className={this.props.inputClassName}\n              style={styles.input}\n              onKeyDown={this.handleInput}\n              type={'text'}\n              autoComplete={'off'}\n              autoCapitalize={'off'}\n              spellCheck={false}\n              disabled={bookState.processing}\n            />\n            }\n          </div>\n\n          {\n            bookState.prediction.state !== \"hidden\" &&\n            <OutputPrediction prediction={bookState.prediction}/>\n\n          }\n        </div>\n      </div>\n    )\n  }\n}\n","export default function validateCommands (commands, helpFn, clearFn, noDefaults) {\n  const defaultCommands = {\n    help: {\n      description: 'Show a list of available commands.',\n      fn: helpFn\n    },\n    clear: {\n      description: 'Empty the terminal window.',\n      explicitExec: true,\n      fn: clearFn\n    }\n  }\n\n  const immutables = Object.keys(defaultCommands)\n\n  let validCommands\n\n  // Pre-register defaults\n  if (!noDefaults) validCommands = { ...defaultCommands }\n  else validCommands = {}\n\n  for (const c in commands) {\n    // Check that command contains a function\n    if (typeof commands[c].fn !== 'function') {\n      throw new Error(`'fn' property of command '${c}' is invalid; expected 'function', got '${typeof commands[c].fn}'`)\n    }\n\n    // Check that the command does not attempt to override immutables\n    if (!noDefaults && immutables.includes(c)) {\n      throw new Error(`Attempting to overwrite default command '${immutables[immutables.indexOf(c)]}'; cannot override default commands when noDefaults isn't set`)\n    }\n\n    // Add description if missing\n    if (!commands[c].description) commands[c].description = 'None'\n\n    // Pass validation\n    validCommands[c] = commands[c]\n  }\n\n  return validCommands\n}\n","import React from \"react\";\nimport {bookSetState, reorderSolutionLines, revealSolutionToken, showHint} from \"./book/store\";\nimport {DragDropContext, Draggable, Droppable} from \"react-beautiful-dnd\";\nimport * as terms from \"./terms.json\"\nimport _ from \"lodash\";\n\nexport const HintsAssistant = (assistant) => {\n  const hasHints = assistant.step.hints.length;\n  return (\n    <div\n         onCopy={(event) => {\n           alert(terms.copying_solution_not_allowed);\n           event.preventDefault();\n         }}\n    >\n        <div className=\"hints-popup\">\n          {!hasHints && <p>{terms.no_hints_available}</p>}\n          {\n            assistant.numHints === 0 && hasHints ?\n              <button onClick={showHint} className=\"btn btn-primary\">{terms.get_hint}</button>\n              :\n              <Hints {...assistant}/>\n          }\n        </div>\n    </div>\n  )\n}\n\nconst hintsProgress = _.template(terms.hints_progress);\n\nconst Hints = ({step: {hints, solution}, numHints, requestingSolution}) =>\n  <div className=\"markdown-body\">\n    {hints.slice(0, numHints).map((hint, index) =>\n      <div className=\"hint-body\" key={index}>\n        <div key={index} dangerouslySetInnerHTML={{__html: hint}}/>\n        <hr/>\n      </div>\n    )}\n    <div>\n      {\n        numHints < hints.length ?\n          <button onClick={showHint} className=\"btn btn-primary\">\n            {terms.get_another_hint}\n          </button>\n          :\n          <RequestSolution1\n            requestingSolution={requestingSolution}\n            solution={solution}\n          />\n      }\n    </div>\n    {\n      numHints < hints.length &&\n      <span className=\"small hints-progress\">{hintsProgress({numHints, totalHints: hints.length})}</span>\n    }\n  </div>\n\n\nconst RequestSolution1 = ({requestingSolution, solution}) => {\n  if (requestingSolution === 0) {\n    return (\n      <button onClick={() => bookSetState(\"assistant.requestingSolution\", solution.lines ? 1 : 3)} className=\"btn btn-primary\">\n        {solution.lines ?\n          terms.show_shuffled_solution :\n          terms.show_solution}\n      </button>\n    )\n  } else if (requestingSolution === 1) {\n    return <ConfirmSolution1/>\n  } else {\n    return <>\n      {solution.lines && <>\n        <Parsons lines={solution.lines}/>\n        <p>{\" \"}</p>\n        <p>{terms.parsons_solution_instructions}</p>\n      </>}\n      <RequestSolution2\n        requestingSolution={requestingSolution}\n        solution={solution}\n      />\n    </>\n  }\n}\n\n\nconst RequestSolution2 = ({requestingSolution, solution}) => {\n  if (requestingSolution === 2) {\n    return <button onClick={() => bookSetState(\"assistant.requestingSolution\", 3)} className=\"btn btn-primary\">\n      {solution.lines ?\n        terms.show_unscrambled_solution :\n        terms.show_solution}\n    </button>\n  } else if (requestingSolution === 3) {\n    return <ConfirmSolution2/>\n  } else {\n    return <Solution solution={solution}/>\n  }\n\n}\n\n\nconst ConfirmSolution1 = () => <>\n  <p>{terms.are_you_sure}</p>\n  <p>\n    <button onClick={() => bookSetState(\"assistant.requestingSolution\", 2)} className=\"btn btn-primary\">\n      {terms.yes}\n    </button>\n    {\" \"}\n    <button onClick={() => bookSetState(\"assistant.requestingSolution\", 0)}\n            className=\"btn-default btn\">\n      {terms.no}\n    </button>\n  </p>\n</>\n\n\nconst ConfirmSolution2 = () => <>\n  <p>{terms.are_you_sure}</p>\n  <p>\n    <button onClick={() => bookSetState(\"assistant.requestingSolution\", 4)} className=\"btn btn-primary\">\n      {terms.yes}\n    </button>\n    {\" \"}\n    <button onClick={() => bookSetState(\"assistant.requestingSolution\", 2)}\n            className=\"btn-default btn\">\n      {terms.no}\n    </button>\n  </p>\n</>\n\n\nconst Parsons = ({lines}) =>\n  <DragDropContext\n    onDragEnd={(result) => {\n      if (result.destination) {\n        reorderSolutionLines(\n          result.source.index,\n          result.destination.index\n        )\n      }\n    }}>\n    <Droppable droppableId=\"droppable\">\n      {(provided) => (\n        <div\n          className=\"parsons-droppable\"\n          {...provided.droppableProps}\n          ref={provided.innerRef}\n        >\n          {lines.map((line, index) => (\n            <Draggable key={line.id} draggableId={line.id} index={index}>\n              {(provided) => (\n                <div\n                  ref={provided.innerRef}\n                  {...provided.draggableProps}\n                  {...provided.dragHandleProps}\n                  style={provided.draggableProps.style}\n                >\n                  <pre>\n                    <code className=\"codehilite\"\n                          dangerouslySetInnerHTML={{__html: line.content}}/>\n                  </pre>\n                </div>\n              )}\n            </Draggable>\n          ))}\n          {provided.placeholder}\n        </div>\n      )}\n    </Droppable>\n  </DragDropContext>\n\n\nconst Solution = ({solution}) =>\n  <div className=\"gradual-solution\">\n    <pre>\n      <code>\n        {solution.tokens.map((token, tokenIndex) =>\n          <span\n            className={\n              `solution-token-${solution.mask[tokenIndex]\n                ? \"hidden\" : \"visible\"}`\n            }\n            key={tokenIndex}\n          >\n            {token}\n          </span>\n        )}\n    </code>\n    </pre>\n    {solution.maskedIndices.length > 0 &&\n    <>\n      <p>{terms.hidden_solution_instructions}</p>\n      <p>\n        <button onClick={revealSolutionToken} className=\"btn btn-primary\">\n          {terms.reveal}\n        </button>\n      </p>\n    </>}\n  </div>\n","import React, {useState} from \"react\";\n\nexport const HookInput = (hook, options, element = \"input\") =>\n  React.createElement(element,\n    {\n      value: hook[0],\n      onChange: (e) => hook[1](e.target.value),\n      ...options,\n    })\n\nexport const useInput = (initialValue, options, element = \"input\") => {\n  const hook = useState(initialValue);\n  const input = HookInput(hook, options, element);\n  return {input, value: hook[0]};\n}\n","import React from 'react';\nimport {useInput} from \"./frontendlib/HookInput\";\nimport Popup from \"reactjs-popup\";\nimport {bookSetState, bookState} from \"./book/store\";\nimport axios from \"axios\";\nimport * as terms from \"./terms.json\"\nimport * as Sentry from \"@sentry/react\";\nimport {uuidv4} from \"sync-message\";\n\n\nexport const FeedbackModal = ({close, error}) => {\n  let initialTitle, instructions;\n  if (error) {\n    initialTitle = error.title;\n    instructions = <>\n      <h3>{terms.report_error}</h3>\n      <p>{terms.report_error_instructions}</p>\n      <details>\n        <summary>{terms.click_for_error_details}</summary>\n        <pre>{error.details}</pre>\n      </details>\n\n    </>\n  } else {\n    initialTitle = \"\";\n    instructions = <>\n      <h3>{terms.give_feedback}</h3>\n      <div dangerouslySetInnerHTML={{__html: terms.give_feedback_instructions}}/>\n    </>\n  }\n  const email = useInput(bookState.user.email || \"\", {\n    placeholder: terms.feedback_email_placeholder,\n    type: 'text',\n    className: 'form-control',\n    style: {\n      width: \"100%\",\n    },\n  });\n  const title = useInput(initialTitle, {\n    placeholder: terms.title,\n    type: 'text',\n    className: 'form-control',\n    style: {\n      width: \"100%\",\n    },\n  });\n  const description = useInput('', {\n    placeholder: terms.description,\n    className: 'form-control',\n    style: {\n      width: \"100%\",\n      minHeight: \"8em\",\n    }\n  }, 'textarea')\n  return (\n    <div style={{margin: \"1em\"}}>\n      {instructions}\n\n      <div>{email.input}</div>\n      <br/>\n      <div>{title.input}</div>\n      <br/>\n      <div>{description.input}</div>\n      <br/>\n      <div>\n        <button\n          className=\"btn btn-primary\"\n          disabled={!(title.value && description.value)}\n          onClick={() => {\n            // Get the last actual event (if any) before we override it now\n            const lastEvent = Sentry.lastEventId();\n            // Create an artificial event so that user feedback can be attached to it.\n            // Set a unique fingerprint to prevent grouping so that an email notification is triggered.\n            Sentry.withScope(scope => {\n              scope.setFingerprint([uuidv4()]);\n              Sentry.captureMessage(`User feedback`);\n            });\n            const comments = `${email.value ? `Email: ${email.value}\\n` : ''}\n${lastEvent ? `Last event: ${lastEvent}\\n` : ''}\n${title.value.trim()}\n\n${description.value.trim()}`;\n            axios.post(\n              'https://sentry.io/api/0/projects/futurecoder/frontend/user-feedback/',\n              {\n                event_id: Sentry.lastEventId(),  // the captureMessage event just now\n                name: \"John Doe\",  // name and email are required by Sentry\n                email: \"john@example.com\",\n                comments,\n              },\n              {\n                headers: {\n                  Authorization: 'DSN ' + process.env.REACT_APP_SENTRY_DSN,\n                }\n              }\n            );\n            close();\n          }}\n        >\n          {terms.submit}\n        </button>\n\n        <button\n          className=\"btn btn-default\"\n          onClick={close}\n        >\n          {terms.cancel}\n        </button>\n      </div>\n      <br/>\n      <br/>\n      <div>\n        {terms.contact_directly}\n        <ul>\n          <li>\n            <a href=\"mailto:hello@futurecoder.io\">\n              {terms.send_email_to} hello@futurecoder.io\n            </a>\n          </li>\n          <li>\n            <a href=\"https://github.com/alexmojaki/futurecoder/issues/new\">\n              {terms.open_github_issue}\n            </a>\n          </li>\n          <li>\n            <a href=\"https://join.slack.com/t/futurecoder/shared_invite/zt-tp8cmwra-CbdEeX9u3k1VyoMLDupAeQ\">\n              {terms.chat_on_slack}\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\n\nexport const ErrorModal = ({error}) => {\n  if (!error) {\n    return null;\n  }\n  return (\n    <Popup\n      open={true}\n      onClose={() => bookSetState(\"error\", null)}\n      contentStyle={feedbackContentStyle}\n    >\n      {close => <FeedbackModal close={close} error={error}/>}\n    </Popup>\n  )\n};\n\n\nexport const feedbackContentStyle = {\n  maxHeight: \"90vh\",\n  overflow: \"auto\",\n  background: \"white\",\n  border: \"solid 1px lightgray\",\n}\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAnCAYAAAB9qAq4AAAAAXNSR0IArs4c6QAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAAKyUlEQVRYCb1YCVBU2RV9vUAv0Cy90A3dbAKCNAwKDQREhQgaHcbdUZBJ1JmyLDJlRI1ljSZu5ZIYTCXWVCUVy2WsaJUyKdRKtFwiiiFucUwUd0AFQcB9GZZeXu69/f+3HWfiEpxX9f9b/3vnnXvfvfd9RW5OzsWQ4OCiDIdDm5eX13Xu3Lm77HmSTZ48WXHx4sXnLd9zSRYfH1dz/XrDsPDwcKZWqTpMYcYzfn6qv/j5+R2uqam54YNHAWUOj8en7d0Xh+blbfVTKnHhXni4v78/1+kCeVRUZHN6evofioqKRs+aNUvrg0S+bNkyuU/93RZTU+2/8Pf340wmc8nlcjes5oQHWeIajYZbLGZPXHzcP+2p9nmzZ//Y6oNG8b0ALSz84QyTyYQMumQyGeYkRii/AFatUfHEpMSmxMSElWPGjEn0AYpsvjtGR44cXmAyGok1AEXMoZiVXrFzoc2FGxDA84SEhPYhQwb/afr06ak+QJVQlvnU+6aY63CkhFvMHTAbgGEehUJBLAYGBnKr1cpB7FRHdolVmReoTqfjSUlJHfCsmTBhgk1Eg6deLPdJDhNaY2NiriBAQQd5dna2KGoCGRERQfqIY/AhoF5d5XDaYUzErezMjPnl5eWBAigE2TdiB0VXx8bG1uHCoaGhJMaKigq+f/9+vnDhzyWgID1us9kIkAASN4QqgerBg4DRxP4Jx4qKCoZDXUx9w2a6I73K38+fK5RKp9FoJFBHjhzhLpeLnz17lq9ZswbBUzvmKHo/PzJNyCY+pKNYNpmMLrCtvyktLQ0VUP7/uulwpK/XarQIwGUwGAiI3Z7M29raOKbe3l5eX19PQGEM9eNGLBYLlbENwUFObKLYk5IS/lVQMGQwtGHCw/P2Ik9JSZ6DhwImQdPCQeS08I4d2wmgx+OhHF8IdPHixRIwHBsUpKO6wCaKnYy+0Wh4kpubOwfqYno7kMOH508KCwsTzYhHZLG0tIQ/ePCAwD19+pQ/fvyYyi6Xk9fV1XEwMxLQqKgoqSwAJTbN5jCem/uDz2GsWkD55npZXPyjHJvV+gwmQFF50A6imLCOOogJga5atYofPnyYO51OakPQu6t384EDB9JYBCnqKoIUrIJLpfLn/fsn/HX8+PEGBPnGpmjq1KmR4HtvISC5nDwInVis79u3j8Dgq7KykoAsXbqUgOMhwtTY2MjBGkgM4mnHb4X5SOTaAA03m40HLZZAE7Rjen0mMRiIiYkhUwM7J5eHtg8m4YcOHSIQ+KqqqpIWHjlyBO/s7JD6EOyBAwd4psNBY1A3NRo1lZFNmIv0Uq8PPSYyCW2v1EkaAGC6QQwt8MFLCTyL1AZilsoff/wJMxq9ZMApZ26Xi0Hkw3ZVVbFFixaxpqYmJpcrWViYicEuoCz3g4+dXd3dQ65cubQJbK0G6sju64EcMCDx14L/JQbR1sHHfM+ePcTSs2fPwHAvpLa4uH780qVLEnt4YObNq+Atzc3U1tXVxbdv305jcQ6rIHLUb6j3ojtNTEz8HZQxoQn6Th+O6KkzODi4OUgneirYlsy7sYcPH+IkDBZlLS1ekpOTkxmcdGrHF5getn79b9ncuXPZqVOnmFqtZiUlJayu7h8sP38Yuw3fgQohk4BRpnS73Z729jtzMjIG/gQ+x408FxNO6JvEEzW2uPiDiIhwHOzGnUZGRhIDq1evJlba2lp5QcEwapsxY4ZkcrDz9u3bfOLECdQH3/Mvv6ySTjqIms+cOYP6+vXrhycby2TSINZszc/JSUI8Ig4sfzMRVTk5OalgC4WoRuYWYkT+UVkZR/F2dnbywsLhtNDMmTMlgMAGbeDKlcvcnmyXQK5fX8kfPXpEffjtiuXLJZBCxER2EkT9N3Cr6A4xfauoCSBFNbGxl2EQysGNttAg+OVr167xJ0+e8Gll02iRkpKp/P79+7Q4tp88eZIAHz16lIeHW3h0dDSNq6iYy1tbW2ncM7CZ69ato/a4uDi6WsBaTgzb4LL2K0QH6VtFTahBj/yzsrKO+YpAFPMXX2ylwGHlypW0wKBBg3hDQwMtjAxu2bKZYxuqw+DBg2kMBLWUozqA7tLY7u5uvmnTJmoHnUSQeGjQtbpGjBjxASLMz88X2cSqlAh5WlpapUqlwgmI/qCgIJosKzuT37t3jx88eJDq0M+3bt1Ki+ILFxbBY58t0gZG2cxTUlJo/E/Lyzl6HUzohTZu3EjtApOkj8B6PRwso4DIe0KFChMvPyDmLNj5I1xELldQ4CB6hc2bN/M2EBeIgyZXKuT88uXLtCi+UE+3bNkCcWGAtAmcZ8GCBfz8+fMcmRb11RcksIfjnVqtFtlfLWB6EaDQSKLOyMhYq/T6YSeKG32yTmDyzJkzvLq6WgIwe/ZsSRcRpMfjBrfXwP8O/hrZxsinq+tr7II+b0Qkuke0lWvXrqW5ACSRkZqa2g5R+QDEI5Lmq5SImk+aNKn2yeOH2WD/EmDHTphYoQsMJDt49+5dluHIYOg58G8DAEYPwTIzMxmoBtxcGQsN1TNYkIFJYWAJmFKJDoRBn4zsKIiX2kEFGKgUte/du1cG+u5ubm7WAbsgqNZa+GlAeOhj8SXaIlDsSAhYT6rVkj569Ho97RaUmI8e/T6Vo6NjKJ8/fx6/evWqxBJR5vPCMA0W5OPHj6Px48aN4TduNNGIO3fuICnY7kL/Hx8fXwPs+QuYXjY7IsjPPvuZ2W5P2ge6iB/jaXOJhwbKcAIJPIX/WFcqFXzDhg38+PHjHNglV4jmZ8eOHRxPMo7BB7wQ5WVgsjo6vMEGqkJUpJVONBych0OHDh0EY7/beIsgYSfq1NSU38M9Q1zAGRAQQDYSFwOxUTuG/hrvlYHqcCcBX9tf/IZym83KRSng6cXvV6xYATraRUxiWAdtLjw0EF+WQxmTrwp6W8S3CBLroLylEBlf9WHQCeBoxyJINE+REBT43lMMBiP844ni4kUMppI2hUCwvm3bNgKIJxwMOZkcuPZWiYcE1/9fCRWVjvzYsWMjMzMdf4Qg4YFM5r3MQx9OiNGPRwSKbgz/6aDZEKNyGENgfHO8A+l0Xjt74cIFAgkG3V1YWIgerGXJkiWxMP710mQfqvPystKsEZbPbbaITjEghVlIPDIGP6Bkcgo2ELAIWuh/CaQY0qG5AquBID21tbUkmQ9LPix7PXTPRyGTkk6MGjUqeVBa2nLQtTOgo9164d7sA4bYhToyTH/OIHcDw8A2Q8YRiAdUgPLd1dVoKN09PT29wq1xA/Q/XxArr0giAwTy+vXrnXfa22umTJmyHa5rRwwmUyPoUVegLlAboNXqZGAgoU4qAgvL4UGTIRNyaSkAysBVsobGBlZc/L48JCREAf972IkTJ1RgF/8sMSJ98eoCAsVEi58+fbqn4ebNGzdv3To6taRkl1YbsMts0tcGBAad06pVN0JCgh8Y9PqvLeGWHohYe4ExZU9Pt7y314mxITmA6OgoME2XGByO+3a7vRksRTNcL3TgjepeNoTexd/kjXPQQYIcXdYLifNl8k8/bQx1ueT606f/owE7GFxf/2/VV1+d96iValm3q5uZzQb23nvpzGo13aus3HAPzFFLWVnptIaGpogXJuuDCoEVTBRKB5+3JSF4ypSJv+wDTK+cAgHKBLsmF8BjzPfNh34po47u3LmTVO+T6R+N/i+R3lsY3BfycAAAAABJRU5ErkJggg==\"","export default __webpack_public_path__ + \"static/media/language.01e98581.png\";","import React from 'react';\nimport \"./css/toc.scss\"\nimport chapters from \"./chapters.json\"\nimport {bookState} from \"./book/store\";\nimport * as terms from \"./terms.json\"\n\nexport const TableOfContents = () => {\n  const current = bookState.user.pageSlug;\n  return (\n    <div className=\"backend bg-dark toc\">\n      <div className=\"toc-header\">\n        <div className=\"container\">\n          <h1>futurecoder</h1>\n          <div dangerouslySetInnerHTML={{__html: terms.toc_instructions}}/>\n        </div>\n      </div>\n\n      <div className=\"container toc-container\">\n        <div className=\"row\">\n          <div className=\"col-md-9\" role=\"main\">\n            <div className=\"toc-section\">\n              <h1 id=\"toc-toc\">\n                {terms.table_of_contents}\n              </h1>\n              <ol className=\"toc-ol\">\n                {chapters.map(chapter =>\n                  <li>\n                    <h2>{chapter.title}</h2>\n                    <ol>\n                      {chapter.pages.map(page => {\n                        const isCurrent = page.slug === current;\n                          return <li>\n                            <a href={\"#\" + page.slug}\n                               style={isCurrent ? {\n                                 border: '2px solid white',\n                                 fontWeight: 'bold',\n                                 padding: '5px',\n                                 lineHeight: 2\n                               } : {}}\n                              // May have HTML generated from markdown\n                               dangerouslySetInnerHTML={{__html: page.title}}/>\n                            {isCurrent && ` ${terms.current_page}`}\n                          </li>;\n                        }\n                      )}\n                    </ol>\n                  </li>\n                )}\n              </ol>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\nimport {faUser} from \"@fortawesome/free-solid-svg-icons\";\nimport StyledFirebaseAuth from \"react-firebaseui/StyledFirebaseAuth\";\nimport firebase from \"firebase\";\nimport {disableLogin, updateDatabase, updateUserData} from \"../book/store\";\nimport Popup from \"reactjs-popup\";\nimport * as terms from \"../terms.json\"\n\nconst HeaderLoginInfo = ({ email }) => {\n  if (disableLogin) {\n    return null;\n  }\n  return email ?\n    <><FontAwesomeIcon icon={faUser}/> {email}</> :\n    <Popup\n      trigger={\n      <button className=\"btn btn-primary\">\n        <FontAwesomeIcon icon={faUser}/> {terms.login_or_sign_up}\n      </button>\n    }\n    modal\n  >\n    {close =>\n      <StyledFirebaseAuth\n        uiConfig={{\n          signInOptions: [\n            {\n              provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n              requireDisplayName: false,\n            },\n            // TODO not working because of cross origin isolation\n            // firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n            // firebase.auth.FacebookAuthProvider.PROVIDER_ID,\n            // firebase.auth.GithubAuthProvider.PROVIDER_ID,\n          ],\n          autoUpgradeAnonymousUsers: true,\n          callbacks: {\n            // Avoid redirects after sign-in.\n            signInSuccessWithAuthResult: async (authResult) => {\n              // Popup must be closed before updating user data to avoid memory leaks\n              close();\n              if (authResult.user) {\n                await updateUserData(authResult.user);\n              }\n              return false;\n            },\n\n            // Ignore merge conflicts when upgrading anonymous users and continue signing in\n            // The store will merge the user data\n            signInFailure: async (error) => {\n              if (error.code === 'firebaseui/anonymous-upgrade-merge-conflict') {\n                // Note the upgrade in the old anonymous account\n                await updateDatabase({upgradedFromAnonymous: true});\n\n                await firebase.auth().signInWithCredential(error.credential);\n                close();\n              }\n            }\n          }\n        }}\n        firebaseAuth={firebase.auth()}\n      />\n    }\n  </Popup>\n}\n\nexport default HeaderLoginInfo;\n","import React from 'react';\nimport Terminal from './shell/Terminal';\nimport \"./css/main.scss\"\nimport \"./css/pygments.css\"\nimport \"./css/github-markdown.css\"\nimport {connect} from \"react-redux\";\nimport {\n  addSpecialMessage,\n  bookSetState,\n  bookState,\n  closeSpecialMessage,\n  currentPage,\n  currentStep,\n  currentStepName,\n  disableLogin,\n  logEvent,\n  movePage,\n  moveStep,\n  openAssessment,\n  postCodeEntry,\n  setDeveloperMode,\n  setEditorContent,\n  signOut,\n  specialHash,\n} from \"./book/store\";\nimport Popup from \"reactjs-popup\";\nimport AceEditor from \"react-ace\";\nimport Collapsible from 'react-collapsible';\nimport \"ace-builds/src-noconflict/mode-python\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome'\nimport {\n  faBars,\n  faBug,\n  faCog,\n  faCompress,\n  faExpand,\n  faLightbulb,\n  faListCheck,\n  faListOl,\n  faPlay,\n  faQuestionCircle,\n  faSignOutAlt,\n  faStop,\n  faUserGraduate\n} from '@fortawesome/free-solid-svg-icons'\nimport {HintsAssistant} from \"./Hints\";\nimport Toggle from 'react-toggle'\nimport \"react-toggle/style.css\"\nimport {ErrorModal, feedbackContentStyle, FeedbackModal} from \"./Feedback\";\nimport birdseyeIcon from \"./img/birdseye_icon.png\";\nimport languageIcon from \"./img/language.png\";\nimport {interrupt, runCode, terminalRef} from \"./RunCode\";\nimport firebase from \"firebase/app\";\nimport {TableOfContents} from \"./TableOfContents\";\nimport HeaderLoginInfo from \"./components/HeaderLoginInfo\";\nimport * as terms from \"./terms.json\"\nimport _ from \"lodash\";\nimport {otherVisibleLanguages} from \"./languages\";\n\n\nconst EditorButtons = (\n  {\n    disabled,\n    showBirdseye,\n    showEditor,\n    showPythonTutor,\n    showSnoop,\n    showQuestionButton,\n    running,\n  }) =>\n  <div className={\"editor-buttons \" + (showEditor ? \"\" : \"invisible\")}>\n    {\n      running ?\n        <button\n          className=\"btn btn-danger\"\n          onClick={() => interrupt()}\n        >\n          <FontAwesomeIcon icon={faStop}/> {terms.stop}\n        </button>\n        :\n        <button\n          disabled={disabled}\n          className=\"btn btn-primary\"\n          onClick={() => runCode({source: \"editor\"})}\n        >\n          <FontAwesomeIcon icon={faPlay}/> {terms.run}\n        </button>\n    }\n\n    {\" \"}\n\n    {showSnoop &&\n      <button\n        disabled={disabled || running}\n        className=\"btn btn-success\"\n        onClick={() => runCode({source: \"snoop\"})}\n      >\n        <FontAwesomeIcon icon={faBug}/> <span style={{fontFamily: \"monospace\"}}>snoop</span>\n      </button>}\n\n    {\" \"}\n\n    {showPythonTutor &&\n      <button\n        disabled={disabled || running}\n        className=\"btn btn-success\"\n        onClick={() => {\n          runCode({source: \"pythontutor\"});\n          let code = bookState.editorContent;\n          if (code.includes(\"assert_equal\") && !code.includes(\"def assert_equal(\")) {\n            code = 'def assert_equal(actual, expected):\\n' +\n              '    if actual == expected:\\n' +\n              '        print(\"OK\")\\n' +\n              '    else:\\n' +\n              '        print(f\"Error! {repr(actual)} != {repr(expected)}\")\\n\\n\\n' + code;\n          }\n          window.open(\n            'https://pythontutor.com/iframe-embed.html#code=' +\n            encodeURIComponent(code) +\n            '&codeDivHeight=600' +\n            '&codeDivWidth=600' +\n            '&cumulative=false' +\n            '&curInstr=0' +\n            '&heapPrimitives=false' +\n            '&origin=opt-frontend.js' +\n            '&py=3' +\n            '&rawInputLstJSON=%5B%5D' +\n            '&textReferences=false',\n          );\n        }}\n      >\n        <FontAwesomeIcon icon={faUserGraduate}/> Python Tutor\n      </button>}\n\n    {\" \"}\n\n    {showBirdseye &&\n      <button\n        disabled={disabled || running}\n        className=\"btn btn-success\"\n        onClick={() => runCode({source: \"birdseye\"})}\n      >\n        <img\n          src={birdseyeIcon}\n          width={20}\n          height={20}\n          alt=\"birdseye logo\"\n          style={{position: \"relative\", top: \"-2px\"}}\n        />\n        <span style={{fontFamily: \"monospace\"}}> birdseye</span>\n      </button>}\n\n    {\" \"}\n\n    {showQuestionButton && !disabled &&\n      <a className=\"btn btn-success\"\n         href={\"#question\"}>\n        <FontAwesomeIcon icon={faQuestionCircle}/> {terms.ask_for_help}\n      </a>}\n  </div>;\n\nconst Editor = ({readOnly, value}) =>\n  <div className=\"editor\">\n    <AceEditor\n      mode=\"python\"\n      theme=\"monokai\"\n      onChange={setEditorContent}\n      onLoad={(editor) => {\n        editor.renderer.setScrollMargin(10);\n        editor.renderer.setPadding(10);\n      }}\n      value={value}\n      name=\"editor\"\n      height=\"100%\"\n      width=\"100%\"\n      fontSize=\"15px\"\n      setOptions={{\n        fontFamily: \"monospace\",\n        showPrintMargin: false,\n      }}\n      readOnly={readOnly}\n    />\n  </div>;\n\nconst Shell = () =>\n  <Terminal\n    onCommand={(cmd) => runCode({code: cmd, source: \"shell\"})}\n    ref={terminalRef}\n  />\n\nconst Messages = (\n  {\n    messageSections,\n  }) => {\n  const nonEmptySections = messageSections.filter(section => section?.messages?.length);\n  if (!nonEmptySections.length) {\n    return <p dangerouslySetInnerHTML={{__html: terms.assessment_description}}/>;\n  }\n  return nonEmptySections.map((section) => {\n    if (section.type === \"passed_tests\") {\n      return <div key={section.type} className=\"card alert alert-success\" style={{padding: 0}}>\n        <div className=\"card-body\">\n          <details>\n            <summary>\n              On the bright side, your code passed {section.messages.length} test(s)!\n            </summary>\n            <br/>\n            <SectionMessages section={section}/>\n          </details>\n        </div>\n      </div>\n    } else if (section.type === \"messages\") {\n      return <div key={section.type}>\n        <SectionMessages section={section}/>\n      </div>;\n    } else {\n      return <div key={section.type}>\n        <div className=\"alert alert-warning\" role=\"alert\">\n          Found the following generic problem(s) in your code:\n        </div>\n        <SectionMessages section={section}/>\n      </div>\n    }\n  });\n}\n\nconst SectionMessages = ({section}) => {\n  return section.messages.map((message, index) =>\n    <div key={index}>\n      <div dangerouslySetInnerHTML={{__html: message}} className={`assistant-${section.type}-message`}/>\n      {index !== section.messages.length - 1 && <hr/>}\n    </div>\n  )\n}\n\nconst Assistant = (assistant) => {\n  const {messageSections, step, lastSeenMessageSections} = assistant;\n  if (!step.requirements) {\n    return null;\n  }\n  const newMessages = messageSections.some((section) => {\n    if (section.type === \"passed_tests\" || !section.messages.length) {\n      return false;\n    }\n    const lastSeenSection = lastSeenMessageSections.find(s => s.type === section.type);\n    return section.messages.some((message) => !lastSeenSection?.messages.includes(message));\n  });\n  return <div className=\"assistant accordion\">\n    <Collapsible classParentString=\"assistant-requirements card\"\n                 contentInnerClassName=\"assistant-content card-body\"\n                 trigger={<div className=\"card-header\">\n                   <FontAwesomeIcon icon={faQuestionCircle}/> {terms.requirements}\n                 </div>}\n    >\n      <p>\n        {terms.requirements_description}\n      </p>\n      <ul>\n        {step.requirements.map((requirement, index) =>\n          <li key={index}>\n            <Requirement requirement={requirement}/>\n          </li>\n        )}\n      </ul>\n    </Collapsible>\n    <Collapsible onOpening={openAssessment}\n                 onClosing={() => bookSetState(\"assessmentOpen\", false)}\n                 classParentString=\"assistant-assessment card\"\n                 contentInnerClassName=\"assistant-content card-body\"\n                 trigger={<div className=\"card-header\">\n                   <FontAwesomeIcon icon={faListCheck}/> {terms.assessment} &nbsp;\n                   {newMessages && <span className=\"badge badge-pill badge-danger\">{terms.new}</span>}\n                 </div>}\n    >\n      <Messages {...{messageSections}}/>\n    </Collapsible>\n    <Collapsible classParentString=\"assistant-hints card\"\n                 contentInnerClassName=\"assistant-content card-body\"\n                 trigger={<div className=\"card-header\">\n                   <FontAwesomeIcon icon={faLightbulb}/> {terms.hints_and_solution}\n                 </div>}\n    >\n      <HintsAssistant {...assistant}/>\n    </Collapsible>\n  </div>\n    ;\n}\n\nconst Requirement = (\n  {\n    requirement,\n  }) => {\n  let text;\n  switch (requirement.type) {\n    case \"verbatim\":\n      text = terms.verbatim;\n      break;\n    case \"exercise\":\n      text = terms.exercise_requirement;\n      break;\n    case \"program_in_text\":\n      text = terms.program_in_text;\n      break;\n    case \"function_exercise\":\n      text = _.template(terms.function_exercise)(requirement);\n      break;\n    case \"function_exercise_goal\":\n      text = _.template(terms.function_exercise_goal)(requirement);\n      break;\n    case \"exercise_stdin\":\n      text = terms.exercise_stdin;\n      break;\n    case \"non_function_exercise\":\n      if (!requirement.inputs.trim()) {\n        text = terms.no_input_variables;\n      } else {\n        text = _.template(terms.non_function_exercise)(requirement);\n      }\n      break;\n    default:\n      text = requirement.message;\n      break;\n  }\n  return <div className=\"assistant-requirement\" dangerouslySetInnerHTML={{__html: text}}/>\n}\n\nconst QuestionWizard = (\n  {\n    messages,\n    requestExpectedOutput,\n    expectedOutput,\n  }) =>\n  <>\n    <h1>{terms.question_wizard}</h1>\n    <div dangerouslySetInnerHTML={{__html: terms.question_wizard_intro}}/>\n    <hr/>\n    {requestExpectedOutput && <>\n      <div dangerouslySetInnerHTML={{__html: terms.question_wizard_expected_output}}/>\n      <AceEditor\n        onChange={value => bookSetState(\"questionWizard.expectedOutput\", value)}\n        theme={\"monokai\"}\n        onLoad={(editor) => {\n          editor.renderer.setScrollMargin(10);\n          editor.renderer.setPadding(10);\n        }}\n        width=\"100%\"\n        height=\"15em\"\n        value={expectedOutput}\n        name=\"expectedOutput\"\n        fontSize=\"15px\"\n        setOptions={{\n          fontFamily: \"monospace\",\n          showPrintMargin: false,\n        }}\n      />\n      <hr/>\n    </>\n    }\n    {messages.map((message, index) =>\n      <div key={index}>\n        <Markdown html={message} copyFunc={text => navigator.clipboard.writeText(text)}/>\n        <hr/>\n      </div>\n    )}\n  </>\n\nconst Markdown = (\n  {\n    html,\n    copyFunc,\n  }) =>\n  <div dangerouslySetInnerHTML={{__html: html}}\n       onClick={(event) => {\n         // https://stackoverflow.com/questions/54109790/how-to-add-onclick-event-to-a-string-rendered-by-dangerouslysetinnerhtml-in-reac\n         const button = event.target.closest(\"button\");\n         if (button && event.currentTarget.contains(button) && button.classList.contains(\"copy-button\")) {\n           const codeElement = button.closest(\"code\");\n           let codeText = codeElement.textContent;\n           codeText = codeText.substring(0, codeText.length - 1 - button.textContent.length);\n           copyFunc(codeText);\n         }\n       }}\n  />\n\nconst CourseText = (\n  {\n    user,\n    step,\n    page,\n    pages,\n    assistant,\n  }) =>\n    <>\n    <h1 dangerouslySetInnerHTML={{__html: page.title}}/>\n    {page.steps.map((part, index) =>\n      <div\n        key={index}\n        id={`step-text-${index}`}\n        className={index > 0 ? 'pt-3' : ''}\n        style={index > step.index ? {display: 'none'} : {}}\n      >\n        <Markdown html={part.text} copyFunc={text => bookSetState(\"editorContent\", text)}/>\n        <hr style={{ margin: '0' }}/>\n      </div>\n    )}\n      <Assistant {...assistant} step={step}/>\n    {/* pt-3 is Bootstrap's helper class. Shorthand for padding-top: 1rem. Available classes are pt-{1-5} */}\n    <div className='pt-3'>\n      {page.index > 0 &&\n      <button className=\"btn btn-primary previous-button\"\n              onClick={() => movePage(-1)}>\n        {terms.previous}\n      </button>}\n      {\" \"}\n      {page.index < Object.keys(pages).length - 1 && step.index === page.steps.length - 1 &&\n      <button className=\"btn btn-success next-button\"\n              onClick={() => movePage(+1)}>\n        {terms.next}\n      </button>}\n    </div>\n    <br/>\n    {\n      user.developerMode && <StepButtons/>\n    }\n  </>\n\nclass AppComponent extends React.Component {\n  render() {\n    const {\n      editorContent,\n      assistant,\n      specialMessages,\n      questionWizard,\n      pages,\n      user,\n      error,\n      prediction,\n      route,\n      previousRoute,\n      running,\n    } = this.props;\n    if (route === \"toc\") {\n      return <TableOfContents/>\n    }\n    const isQuestionWizard = route === \"question\";\n    const fullIde = route === \"ide\";\n\n    const page = currentPage();\n    const step = currentStep();\n\n    let showEditor, showSnoop, showPythonTutor, showBirdseye, showQuestionButton;\n    if (fullIde || isQuestionWizard) {\n      showEditor = true;\n      showSnoop = true;\n      showPythonTutor = true;\n      showBirdseye = true;\n      showQuestionButton = !(isQuestionWizard || previousRoute === \"question\");\n    } else if (step.text.length) {\n      showEditor = page.index >= pages.WritingPrograms.index;\n      const snoopPageIndex = pages.UnderstandingProgramsWithSnoop.index;\n      showSnoop = page.index > snoopPageIndex ||\n        (page.index === snoopPageIndex && step.index >= 1);\n      showPythonTutor = page.index >= pages.UnderstandingProgramsWithPythonTutor.index;\n      showBirdseye = page.index >= pages.IntroducingBirdseye.index;\n      showQuestionButton = page.index > pages.IntroducingBirdseye.index;\n    }\n\n    const cantUseEditor = prediction.state === \"waiting\" || prediction.state === \"showingResult\";\n    return <div className=\"book-container\">\n      <nav className=\"navbar navbar-expand-lg navbar-light bg-light\">\n        <span className=\"nav-item custom-popup\">\n          <MenuPopup user={user}/>\n        </span>\n        <span className=\"nav-item navbar-text\">\n          <HeaderLoginInfo email={user.email}/>\n        </span>\n        <a className=\"nav-item nav-link\" href=\"#toc\">\n          <FontAwesomeIcon icon={faListOl}/> {terms.table_of_contents}\n        </a>\n      </nav>\n\n      {!fullIde &&\n      <div className=\"book-text markdown-body\">\n        {isQuestionWizard ?\n          <QuestionWizard {...questionWizard}/>\n          :\n          <div onCopy={checkCopy}>\n            <CourseText\n              {...{\n                assistant,\n                user,\n                step,\n                page,\n                pages,\n              }}/>\n          </div>\n        }\n      </div>\n\n      }\n\n      <EditorButtons {...{\n        showBirdseye,\n        showEditor,\n        showSnoop,\n        showPythonTutor,\n        showQuestionButton,\n        disabled: cantUseEditor,\n        running,\n      }}/>\n\n      <div className={`ide ide-${fullIde ? 'full' : 'half'}`}>\n        <div className=\"editor-and-terminal\">\n          {showEditor &&\n           <Editor value={editorContent} readOnly={cantUseEditor}/>\n          }\n          <div className=\"terminal\" style={{height: showEditor ? undefined : \"100%\"}}>\n            <Shell/>\n          </div>\n        </div>\n      </div>\n\n      <a className=\"btn btn-primary full-ide-button\"\n         href={\"#\" + (!fullIde ? \"ide\" : (specialHash(previousRoute) ? previousRoute : page.slug))}>\n        <FontAwesomeIcon icon={fullIde ? faCompress : faExpand}/>\n      </a>\n\n      <ErrorModal error={error}/>\n\n      <>\n        {specialMessages.map((message, index) =>\n          <Popup\n            key={index}\n            open={true}\n            onClose={() => closeSpecialMessage(index)}\n          >\n            <SpecialMessageModal message={message}/>\n          </Popup>\n        )}\n      </>\n    </div>\n  }\n}\n\nconst StepButton = ({delta, label}) =>\n  <button className={`btn btn-danger btn-sm button-${label.replace(\" \", \"-\").toLowerCase()}`}\n          onClick={() => {\n            const entry = {skip_step: delta, page_slug: bookState.user.pageSlug, step_name: currentStepName()};\n            postCodeEntry(entry);\n            logEvent('skip_step', entry);\n            moveStep(delta);\n          }}>\n    {label}\n  </button>\n\nconst StepButtons = () =>\n  <div style={{position: \"fixed\", bottom: 0}}>\n    <StepButton delta={-1} label={terms.reverse_step}/>\n    {\" \"}\n    <StepButton delta={+1} label={terms.skip_step}/>\n  </div>\n\n\nconst MenuPopup = ({user}) =>\n    <Popup\n      nested\n      trigger={\n        <button className=\"btn btn-sm btn-outline-secondary\">\n          <FontAwesomeIcon icon={faBars} size=\"lg\"/>\n        </button>}\n    >\n      {close => <div className=\"menu-popup\">\n        {!disableLogin &&\n          <p>\n            <button\n              className=\"btn btn-danger\"\n              onClick={() => {\n                close();\n                signOut();\n                firebase.auth().signOut();\n              }}\n            >\n              <FontAwesomeIcon icon={faSignOutAlt}/> {terms.sign_out}\n            </button>\n          </p>\n        }\n        <p>\n          <Popup\n            trigger={\n              <button className=\"btn btn-primary\">\n                <FontAwesomeIcon icon={faCog}/> {terms.settings}\n              </button>\n              }\n            modal\n            nested\n          >\n            <SettingsModal user={user}/>\n          </Popup>\n        </p>\n      <p>\n        <a href=\"/\" className=\"btn btn-secondary\">\n          返回輕鬆學Python\n        </a>\n      </p>\n        {/* <p>\n          <Popup\n            trigger={\n              <button className=\"btn btn-success\">\n                <FontAwesomeIcon icon={faBug}/> {terms.feedback}\n              </button>\n            }\n            modal\n            nested\n            contentStyle={feedbackContentStyle}\n          >\n            {close => <FeedbackModal close={close}/>}\n          </Popup>\n        </p> */}\n        {\n          otherVisibleLanguages.map(lang =>\n            <p key={lang.code}>\n              <a href={lang.url + \"course/\"} className=\"btn btn-link\"\n                 style={{borderColor: \"grey\"}}>\n                <img\n                  alt=\"language icon\"\n                  src={languageIcon}\n                  width={24}\n                  height={24}\n                  style={{\n                    display: \"inline\",\n                    position: \"relative\",\n                    top: \"-2px\",\n                    left: \"-2px\",\n                  }}\n                /> {lang.name}\n              </a>\n            </p>\n          )\n        }\n      </div>}\n    </Popup>\n\n\nconst SettingsModal = ({user}) => (\n  <div className=\"settings-modal\">\n    <h1>{terms.settings}</h1>\n    <br/>\n    <label>\n      <Toggle\n        defaultChecked={user.developerMode}\n        onChange={(e) => setDeveloperMode(e.target.checked)}\n      />\n      <b>{terms.developer_mode}</b>\n    </label>\n\n    <p>{terms.developer_mode_description}</p>\n  </div>\n)\n\nconst SpecialMessageModal = ({message}) => (\n  <div className=\"special-message-modal\">\n    <div dangerouslySetInnerHTML={{__html: message}}/>\n  </div>\n);\n\nconst checkCopy = () => {\n  const selection = document.getSelection();\n  const codeElement = (node) => node.parentElement.closest(\"code\");\n  if (\n    [...document.querySelectorAll(\".book-text code\")]\n      .filter(node => selection.containsNode(node))\n      .concat([\n        codeElement(selection.anchorNode),\n        codeElement(selection.focusNode),\n      ])\n      .some((node) => node && !node.classList.contains(\"copyable\"))\n  ) {\n    addSpecialMessage(terms.copy_warning);\n  }\n}\n\n\nexport const App = connect(\n  state => ({\n    ...state.book,\n  }),\n)(AppComponent);\n\n","import {applyMiddleware, combineReducers, compose, createStore} from \"redux\";\nimport thunk from \"redux-thunk\";\nimport logger from \"redux-logger\";\nimport {connect} from \"react-redux\";\nimport {dispatcher, redact, TextContainer} from \"./frontendlib\";\nimport {bookReducer, currentStep, localStore, navigate} from \"./book/store\";\nimport * as Sentry from \"@sentry/react\";\nimport _ from \"lodash\";\n\nconst sentryReduxEnhancer = Sentry.createReduxEnhancer({\n  actionTransformer: action => {\n    if (action.type === \"LOAD_PAGES\") {\n      return null;\n    }\n    if (action.type === \"RAN_CODE\") {\n      try {\n        action = {\n          ...action,\n          messages: action.messages?.map(m => _.truncate(m, {length: 100})),\n          output: _.truncate(action.output, {length: 100}),\n        }\n      } catch {\n      }\n    }\n    return action;\n  },\n  stateTransformer: state => {\n    state = state.book;\n    try {\n      state = {...state, currentStep: currentStep(state)};\n    } catch {\n    }\n    return _.omit(state, \"pages\", \"pageSlugsList\");\n  },\n});\n\nconst sentryDsn = process.env.REACT_APP_SENTRY_DSN;\nif (sentryDsn) {\n  console.log('Configuring sentry');\n  Sentry.init({\n    dsn: sentryDsn,\n    normalizeDepth: 5,\n    beforeBreadcrumb(breadcrumb, hint) {\n      const {message} = breadcrumb;\n      if (message.includes(\"prev state\") || message.includes(\"next state\")) {\n        return null;\n      }\n      return breadcrumb;\n    },\n  });\n}\n\nconst {delegateReducer} = redact(\"root\");\n\nTextContainer.connect = connect;\n\nconst saveToLocalStoreMiddleware = store => next => async (action) => {\n  // first call the next middleware function in the chain; we want the state to be updated so that, when we should\n  // update the storage, we have the values that we need.\n  next(action);\n  const {user, editorContent} = store.getState().book;\n  if (!user.uid) {  // still in initial loading stage\n    return;\n  }\n  // Save the data in the same shape as in firebase\n  await localStore.setItem('user', {editorContent, ...user});\n};\n\nconst reducer = delegateReducer(\n  combineReducers({\n    book: bookReducer,\n  })\n);\n\n// noinspection JSUnresolvedVariable\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nexport const store = createStore(\n  reducer,\n  composeEnhancers(\n    applyMiddleware(\n      thunk,\n      logger,\n      saveToLocalStoreMiddleware,\n    ),\n    sentryReduxEnhancer,\n  )\n);\n\ndispatcher.store = store;\nredact.store = store;\nwindow.reduxStore = store;\n\nnavigate();\n","// `npm start` tends to set the path to `/course` without a trailing `/`\n// which stops the service worker from working. Redirect if necessary.\nif (window.location.pathname !== \"/course/\") {\n  window.location.pathname = \"/course/\";\n}\n\n// Reference: https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)){3}$/)\n);\n\nexport function register() {\n  // XXX Unlike some usages of PWAs, we always register the service worker (including in dev);\n  // this is because our service worker has responsibilities besides caching. But as you can see\n  // in service-worker.js, we only do the caching parts when REACT_APP_PRECACHE is set.\n  // (To avoid confusing caching in development (same as general pattern with CRA PWAs))\n\n  if ('serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n            } else {\n              if (process.env.REACT_APP_PRECACHE) {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // \"Content is cached for offline use.\" message.\n                console.log('Content is cached for offline use.');\n              } else {\n                console.log('Service worker has registered, but caching is not enabled for development mode.')\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {App} from './App';\nimport {Provider} from \"react-redux\";\nimport {store} from \"./store\";\n\n\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\n\n\nReactDOM.render(\n    <Provider store={store}>\n      <App/>\n    </Provider>,\n  document.getElementById(\"root\")\n);\n\n// Always run the service worker (even in dev) (but it only enables PWA-style precaching depending on an env variable)\nserviceWorkerRegistration.register();\n"],"sourceRoot":""}